<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Automating repeated things | Computational Thinking for Social Scientists</title>
  <meta name="description" content="Chapter 5 Automating repeated things | Computational Thinking for Social Scientists. Online textbook for PS239T" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Automating repeated things | Computational Thinking for Social Scientists" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Chapter 5 Automating repeated things | Computational Thinking for Social Scientists. Online textbook for PS239T" />
  <meta name="github-repo" content="jaeyk/PS239T" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Automating repeated things | Computational Thinking for Social Scientists" />
  <meta name="twitter:site" content="@JaeJaeykim2" />
  <meta name="twitter:description" content="Chapter 5 Automating repeated things | Computational Thinking for Social Scientists. Online textbook for PS239T" />
  

<meta name="author" content="Jae Yeon Kim" />


<meta name="date" content="2020-09-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tidy-data.html"/>
<link rel="next" href="semi-structured-data.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Computational Thinking for Social Scientists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> PS239T</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#textbook"><i class="fa fa-check"></i><b>1.1</b> Textbook</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#objectives"><i class="fa fa-check"></i><b>1.2</b> Objectives</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#part-i-fundamentals"><i class="fa fa-check"></i><b>1.2.1</b> Part I Fundamentals</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#part-ii-applications"><i class="fa fa-check"></i><b>1.2.2</b> Part II Applications</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#logistics"><i class="fa fa-check"></i><b>1.3</b> Logistics</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i><b>1.3.1</b> Contributors</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#time-and-location"><i class="fa fa-check"></i><b>1.3.2</b> Time and location</a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#office-hours"><i class="fa fa-check"></i><b>1.3.3</b> Office hours</a></li>
<li class="chapter" data-level="1.3.4" data-path="index.html"><a href="index.html#slack-github"><i class="fa fa-check"></i><b>1.3.4</b> Slack &amp; GitHub</a></li>
<li class="chapter" data-level="1.3.5" data-path="index.html"><a href="index.html#accessibility"><i class="fa fa-check"></i><b>1.3.5</b> Accessibility</a></li>
<li class="chapter" data-level="1.3.6" data-path="index.html"><a href="index.html#code-for-conduct"><i class="fa fa-check"></i><b>1.3.6</b> Code for conduct</a></li>
<li class="chapter" data-level="1.3.7" data-path="index.html"><a href="index.html#course-requirements-and-grades"><i class="fa fa-check"></i><b>1.3.7</b> Course requirements and grades</a></li>
<li class="chapter" data-level="1.3.8" data-path="index.html"><a href="index.html#class-activities-and-materials"><i class="fa fa-check"></i><b>1.3.8</b> Class activities and materials</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#course-schedule"><i class="fa fa-check"></i><b>1.4</b> Course schedule</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#part-i-fundamentals-1"><i class="fa fa-check"></i><b>1.4.1</b> Part I Fundamentals</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#part-ii-applications-1"><i class="fa fa-check"></i><b>1.4.2</b> Part II Applications</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#questions-comments-or-suggestions"><i class="fa fa-check"></i><b>1.5</b> Questions, comments, or suggestions</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#special-thanks"><i class="fa fa-check"></i><b>1.6</b> Special thanks</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i><b>1.7</b> License</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="motivation.html"><a href="motivation.html"><i class="fa fa-check"></i><b>2</b> Computational thinking</a>
<ul>
<li class="chapter" data-level="2.1" data-path="motivation.html"><a href="motivation.html#why-computational-thinking"><i class="fa fa-check"></i><b>2.1</b> Why computational thinking</a></li>
<li class="chapter" data-level="2.2" data-path="motivation.html"><a href="motivation.html#computational-way-of-thinking-about-data"><i class="fa fa-check"></i><b>2.2</b> Computational way of thinking about data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="motivation.html"><a href="motivation.html#structure"><i class="fa fa-check"></i><b>2.2.1</b> Structure</a></li>
<li class="chapter" data-level="2.2.2" data-path="motivation.html"><a href="motivation.html#dimension"><i class="fa fa-check"></i><b>2.2.2</b> Dimension</a></li>
<li class="chapter" data-level="2.2.3" data-path="motivation.html"><a href="motivation.html#size"><i class="fa fa-check"></i><b>2.2.3</b> Size</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="motivation.html"><a href="motivation.html#computational-way-of-thinking-about-research-process"><i class="fa fa-check"></i><b>2.3</b> Computational way of thinking about research process</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>3</b> Managing data and code</a>
<ul>
<li class="chapter" data-level="3.1" data-path="intro.html"><a href="intro.html#project-oriented-research"><i class="fa fa-check"></i><b>3.1</b> Project-oriented research</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="intro.html"><a href="intro.html#computational-reproducibility"><i class="fa fa-check"></i><b>3.1.1</b> Computational reproducibility</a></li>
<li class="chapter" data-level="3.1.2" data-path="intro.html"><a href="intro.html#version-control-git-and-bash"><i class="fa fa-check"></i><b>3.1.2</b> Version control (Git and Bash)</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="intro.html"><a href="intro.html#writing-code-how-to-code-like-a-professional"><i class="fa fa-check"></i><b>3.2</b> Writing code: How to code like a professional</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="intro.html"><a href="intro.html#write-readable-code"><i class="fa fa-check"></i><b>3.2.1</b> Write readable code</a></li>
<li class="chapter" data-level="3.2.2" data-path="intro.html"><a href="intro.html#write-reusable-code"><i class="fa fa-check"></i><b>3.2.2</b> Write reusable code</a></li>
<li class="chapter" data-level="3.2.3" data-path="intro.html"><a href="intro.html#test-your-code-systematically"><i class="fa fa-check"></i><b>3.2.3</b> Test your code systematically</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="intro.html"><a href="intro.html#asking-questions-minimal-reproducible-example"><i class="fa fa-check"></i><b>3.3</b> Asking questions: Minimal reproducible example</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="intro.html"><a href="intro.html#how-to-create-a-minimal-reproducible-example"><i class="fa fa-check"></i><b>3.3.1</b> How to create a minimal reproducible example</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="intro.html"><a href="intro.html#references"><i class="fa fa-check"></i><b>3.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tidy-data.html"><a href="tidy-data.html"><i class="fa fa-check"></i><b>4</b> Tidy data and its friends</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tidy-data.html"><a href="tidy-data.html#tidyverse-way-of-thinking-data-science-workflow"><i class="fa fa-check"></i><b>4.1</b> Tidyverse way of thinking data science workflow</a></li>
<li class="chapter" data-level="4.2" data-path="tidy-data.html"><a href="tidy-data.html#tidy-data-and-why-it-matters"><i class="fa fa-check"></i><b>4.2</b> Tidy data and why it matters</a></li>
<li class="chapter" data-level="4.3" data-path="tidy-data.html"><a href="tidy-data.html#wrangling-data"><i class="fa fa-check"></i><b>4.3</b> Wrangling data</a></li>
<li class="chapter" data-level="4.4" data-path="tidy-data.html"><a href="tidy-data.html#wrangling-data-at-scale"><i class="fa fa-check"></i><b>4.4</b> Wrangling data at scale</a></li>
<li class="chapter" data-level="4.5" data-path="tidy-data.html"><a href="tidy-data.html#modeling-and-visualizing-tidy-data"><i class="fa fa-check"></i><b>4.5</b> Modeling and visualizing tidy data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="functional-programming.html"><a href="functional-programming.html"><i class="fa fa-check"></i><b>5</b> Automating repeated things</a>
<ul>
<li class="chapter" data-level="5.1" data-path="functional-programming.html"><a href="functional-programming.html#why-functional-programming"><i class="fa fa-check"></i><b>5.1</b> Why functional programming</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="functional-programming.html"><a href="functional-programming.html#why-map"><i class="fa fa-check"></i><b>5.1.1</b> Why map?</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="functional-programming.html"><a href="functional-programming.html#automote-2-or-2-tasks"><i class="fa fa-check"></i><b>5.2</b> Automote 2 or 2+ Tasks</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="functional-programming.html"><a href="functional-programming.html#objectives-1"><i class="fa fa-check"></i><b>5.2.1</b> Objectives</a></li>
<li class="chapter" data-level="5.2.2" data-path="functional-programming.html"><a href="functional-programming.html#problem"><i class="fa fa-check"></i><b>5.2.2</b> Problem</a></li>
<li class="chapter" data-level="5.2.3" data-path="functional-programming.html"><a href="functional-programming.html#for-loop"><i class="fa fa-check"></i><b>5.2.3</b> For loop</a></li>
<li class="chapter" data-level="5.2.4" data-path="functional-programming.html"><a href="functional-programming.html#map2-pmap"><i class="fa fa-check"></i><b>5.2.4</b> map2 &amp; pmap</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="functional-programming.html"><a href="functional-programming.html#automate-plotting"><i class="fa fa-check"></i><b>5.3</b> Automate plotting</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="functional-programming.html"><a href="functional-programming.html#objective"><i class="fa fa-check"></i><b>5.3.1</b> Objective</a></li>
<li class="chapter" data-level="5.3.2" data-path="functional-programming.html"><a href="functional-programming.html#problem-1"><i class="fa fa-check"></i><b>5.3.2</b> Problem</a></li>
<li class="chapter" data-level="5.3.3" data-path="functional-programming.html"><a href="functional-programming.html#solution"><i class="fa fa-check"></i><b>5.3.3</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="functional-programming.html"><a href="functional-programming.html#automate-joining"><i class="fa fa-check"></i><b>5.4</b> Automate joining</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="functional-programming.html"><a href="functional-programming.html#objective-1"><i class="fa fa-check"></i><b>5.4.1</b> Objective</a></li>
<li class="chapter" data-level="5.4.2" data-path="functional-programming.html"><a href="functional-programming.html#problem-2"><i class="fa fa-check"></i><b>5.4.2</b> Problem</a></li>
<li class="chapter" data-level="5.4.3" data-path="functional-programming.html"><a href="functional-programming.html#copy-and-paste"><i class="fa fa-check"></i><b>5.4.3</b> Copy and paste</a></li>
<li class="chapter" data-level="5.4.4" data-path="functional-programming.html"><a href="functional-programming.html#reduce"><i class="fa fa-check"></i><b>5.4.4</b> reduce</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="functional-programming.html"><a href="functional-programming.html#make-automation-slower-or-faster"><i class="fa fa-check"></i><b>5.5</b> Make automation slower or faster</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="functional-programming.html"><a href="functional-programming.html#objectives-2"><i class="fa fa-check"></i><b>5.5.1</b> Objectives</a></li>
<li class="chapter" data-level="5.5.2" data-path="functional-programming.html"><a href="functional-programming.html#how-to-make-automation-slower"><i class="fa fa-check"></i><b>5.5.2</b> How to make automation slower</a></li>
<li class="chapter" data-level="5.5.3" data-path="functional-programming.html"><a href="functional-programming.html#for-loop-1"><i class="fa fa-check"></i><b>5.5.3</b> For loop</a></li>
<li class="chapter" data-level="5.5.4" data-path="functional-programming.html"><a href="functional-programming.html#map"><i class="fa fa-check"></i><b>5.5.4</b> Map</a></li>
<li class="chapter" data-level="5.5.5" data-path="functional-programming.html"><a href="functional-programming.html#how-to-make-automation-faster"><i class="fa fa-check"></i><b>5.5.5</b> How to make automation Faster</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="functional-programming.html"><a href="functional-programming.html#make-error-handling-easier"><i class="fa fa-check"></i><b>5.6</b> Make error handling easier</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="functional-programming.html"><a href="functional-programming.html#learning-objective"><i class="fa fa-check"></i><b>5.6.1</b> Learning objective</a></li>
<li class="chapter" data-level="5.6.2" data-path="functional-programming.html"><a href="functional-programming.html#solution-1"><i class="fa fa-check"></i><b>5.6.2</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="functional-programming.html"><a href="functional-programming.html#developing-your-own-data-tools"><i class="fa fa-check"></i><b>5.7</b> Developing your own data tools</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="semi-structured-data.html"><a href="semi-structured-data.html"><i class="fa fa-check"></i><b>6</b> Semi-structured data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="semi-structured-data.html"><a href="semi-structured-data.html#htmlcss-web-scraping"><i class="fa fa-check"></i><b>6.1</b> HTML/CSS: web scraping</a></li>
<li class="chapter" data-level="6.2" data-path="semi-structured-data.html"><a href="semi-structured-data.html#xmljson-social-media-scraping"><i class="fa fa-check"></i><b>6.2</b> XML/JSON: social media scraping</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="machine-learning.html"><a href="machine-learning.html"><i class="fa fa-check"></i><b>7</b> High-dimensional data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="machine-learning.html"><a href="machine-learning.html#overview"><i class="fa fa-check"></i><b>7.1</b> Overview</a></li>
<li class="chapter" data-level="7.2" data-path="machine-learning.html"><a href="machine-learning.html#dataset"><i class="fa fa-check"></i><b>7.2</b> Dataset</a></li>
<li class="chapter" data-level="7.3" data-path="machine-learning.html"><a href="machine-learning.html#workflow"><i class="fa fa-check"></i><b>7.3</b> Workflow</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="machine-learning.html"><a href="machine-learning.html#tidymodels"><i class="fa fa-check"></i><b>7.3.1</b> Tidymodels</a></li>
<li class="chapter" data-level="7.3.2" data-path="machine-learning.html"><a href="machine-learning.html#data-split"><i class="fa fa-check"></i><b>7.3.2</b> Data split</a></li>
<li class="chapter" data-level="7.3.3" data-path="machine-learning.html"><a href="machine-learning.html#pre-process"><i class="fa fa-check"></i><b>7.3.3</b> Pre-process</a></li>
<li class="chapter" data-level="7.3.4" data-path="machine-learning.html"><a href="machine-learning.html#model-building"><i class="fa fa-check"></i><b>7.3.4</b> Model building</a></li>
<li class="chapter" data-level="7.3.5" data-path="machine-learning.html"><a href="machine-learning.html#model-evaluation"><i class="fa fa-check"></i><b>7.3.5</b> Model evaluation</a></li>
<li class="chapter" data-level="7.3.6" data-path="machine-learning.html"><a href="machine-learning.html#tuning"><i class="fa fa-check"></i><b>7.3.6</b> Tuning</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="machine-learning.html"><a href="machine-learning.html#supervised-learning"><i class="fa fa-check"></i><b>7.4</b> Supervised learning</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="machine-learning.html"><a href="machine-learning.html#regularization"><i class="fa fa-check"></i><b>7.4.1</b> Regularization</a></li>
<li class="chapter" data-level="7.4.2" data-path="machine-learning.html"><a href="machine-learning.html#decision-tree-and-ensemble-models"><i class="fa fa-check"></i><b>7.4.2</b> Decision tree and ensemble models</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="machine-learning.html"><a href="machine-learning.html#unsupervised-learning"><i class="fa fa-check"></i><b>7.5</b> Unsupervised learning</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="machine-learning.html"><a href="machine-learning.html#dimension-reduction"><i class="fa fa-check"></i><b>7.5.1</b> Dimension reduction</a></li>
<li class="chapter" data-level="7.5.2" data-path="machine-learning.html"><a href="machine-learning.html#clustering"><i class="fa fa-check"></i><b>7.5.2</b> Clustering</a></li>
<li class="chapter" data-level="7.5.3" data-path="machine-learning.html"><a href="machine-learning.html#applications-1"><i class="fa fa-check"></i><b>7.5.3</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="machine-learning.html"><a href="machine-learning.html#bias-and-fairness-in-machine-learning"><i class="fa fa-check"></i><b>7.6</b> Bias and fairness in machine learning</a></li>
<li class="chapter" data-level="7.7" data-path="machine-learning.html"><a href="machine-learning.html#resources"><i class="fa fa-check"></i><b>7.7</b> Resources</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="machine-learning.html"><a href="machine-learning.html#books"><i class="fa fa-check"></i><b>7.7.1</b> Books</a></li>
<li class="chapter" data-level="7.7.2" data-path="machine-learning.html"><a href="machine-learning.html#lecture-slides"><i class="fa fa-check"></i><b>7.7.2</b> Lecture slides</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="big-data.html"><a href="big-data.html"><i class="fa fa-check"></i><b>8</b> Big data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="big-data.html"><a href="big-data.html#database-and-sql"><i class="fa fa-check"></i><b>8.1</b> Database and SQL</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/jaeyk/PS239T/" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Computational Thinking for Social Scientists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functional_programming" class="section level1" number="5">
<h1><span class="header-section-number">Chapter 5</span> Automating repeated things</h1>
<div id="why-functional-programming" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Why functional programming</h2>
<ul>
<li>Setup</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="functional-programming.html#cb28-1"></a><span class="co"># Install packages￣</span></span>
<span id="cb28-2"><a href="functional-programming.html#cb28-2"></a><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(<span class="st">&quot;pacman&quot;</span>)) {</span>
<span id="cb28-3"><a href="functional-programming.html#cb28-3"></a>  <span class="kw">install.packages</span>(<span class="st">&quot;pacman&quot;</span>)</span>
<span id="cb28-4"><a href="functional-programming.html#cb28-4"></a>}</span></code></pre></div>
<pre><code>## Loading required package: pacman</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="functional-programming.html#cb30-1"></a>pacman<span class="op">::</span><span class="kw">p_load</span>(</span>
<span id="cb30-2"><a href="functional-programming.html#cb30-2"></a>  tidyverse, <span class="co"># tidyverse pkgs including purrr</span></span>
<span id="cb30-3"><a href="functional-programming.html#cb30-3"></a>  tictoc, <span class="co"># performance test</span></span>
<span id="cb30-4"><a href="functional-programming.html#cb30-4"></a>  broom, <span class="co"># tidy modeling</span></span>
<span id="cb30-5"><a href="functional-programming.html#cb30-5"></a>  glue, <span class="co"># paste string and objects</span></span>
<span id="cb30-6"><a href="functional-programming.html#cb30-6"></a>  furrr, <span class="co"># parallel processing</span></span>
<span id="cb30-7"><a href="functional-programming.html#cb30-7"></a>  rvest</span>
<span id="cb30-8"><a href="functional-programming.html#cb30-8"></a>) <span class="co"># web scraping</span></span></code></pre></div>
<div id="why-map" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Why map?</h3>
<div id="objectives" class="section level4" number="5.1.1.1">
<h4><span class="header-section-number">5.1.1.1</span> Objectives</h4>
<ul>
<li>How to use <code>purrr</code> to automate workflow in a cleaner, faster, and more extendable way</li>
</ul>
</div>
<div id="copy-and-paste-programming" class="section level4" number="5.1.1.2">
<h4><span class="header-section-number">5.1.1.2</span> Copy-and-paste programming</h4>
<blockquote>
<p>Copy-and-paste programming, sometimes referred to as just pasting, is the production of highly repetitive computer programming code, as produced by copy and paste operations. It is primarily a pejorative term; those who use the term are often implying a lack of programming competence. It may also be the result of technology limitations (e.g., an insufficiently expressive development environment) as subroutines or libraries would normally be used instead. However, there are occasions when copy-and-paste programming is considered acceptable or necessary, such as for boilerplate, loop unrolling (when not supported automatically by the compiler), or certain programming idioms, and it is supported by some source code editors in the form of snippets. - Wikipedia</p>
</blockquote>
<ul>
<li><p>Example</p></li>
<li><p>Let’s imagine <code>df</code> is a survey dataset.</p>
<ul>
<li><p><code>a, b, c, d</code> = Survey questions</p></li>
<li><p><code>-99</code>: non-responses</p></li>
<li><p>Your goal: replace <code>-99</code> with <code>NA</code></p></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="functional-programming.html#cb31-1"></a><span class="co"># Data</span></span>
<span id="cb31-2"><a href="functional-programming.html#cb31-2"></a></span>
<span id="cb31-3"><a href="functional-programming.html#cb31-3"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>) <span class="co"># for reproducibility</span></span>
<span id="cb31-4"><a href="functional-programming.html#cb31-4"></a></span>
<span id="cb31-5"><a href="functional-programming.html#cb31-5"></a>df &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb31-6"><a href="functional-programming.html#cb31-6"></a>  <span class="st">&quot;a&quot;</span> =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">99</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>), <span class="dt">size =</span> <span class="dv">5</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</span>
<span id="cb31-7"><a href="functional-programming.html#cb31-7"></a>  <span class="st">&quot;b&quot;</span> =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">99</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>), <span class="dt">size =</span> <span class="dv">5</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</span>
<span id="cb31-8"><a href="functional-programming.html#cb31-8"></a>  <span class="st">&quot;c&quot;</span> =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">99</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>), <span class="dt">size =</span> <span class="dv">5</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</span>
<span id="cb31-9"><a href="functional-programming.html#cb31-9"></a>  <span class="st">&quot;d&quot;</span> =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">99</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>), <span class="dt">size =</span> <span class="dv">5</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb31-10"><a href="functional-programming.html#cb31-10"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="functional-programming.html#cb32-1"></a><span class="co"># Copy and paste</span></span>
<span id="cb32-2"><a href="functional-programming.html#cb32-2"></a>df<span class="op">$</span>a[df<span class="op">$</span>a <span class="op">==</span><span class="st"> </span><span class="dv">-99</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb32-3"><a href="functional-programming.html#cb32-3"></a>df<span class="op">$</span>b[df<span class="op">$</span>b <span class="op">==</span><span class="st"> </span><span class="dv">-99</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb32-4"><a href="functional-programming.html#cb32-4"></a>df<span class="op">$</span>c[df<span class="op">$</span>c <span class="op">==</span><span class="st"> </span><span class="dv">-99</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb32-5"><a href="functional-programming.html#cb32-5"></a>df<span class="op">$</span>d[df<span class="op">$</span>d <span class="op">==</span><span class="st"> </span><span class="dv">-99</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb32-6"><a href="functional-programming.html#cb32-6"></a></span>
<span id="cb32-7"><a href="functional-programming.html#cb32-7"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##       a     b     c     d
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     3     3     3     1
## 2     3     2     3     1
## 3     1    NA     1     2
## 4     1    NA     2     1
## 5    NA     1     1     3</code></pre>
<ul>
<li><strong>Challenge</strong>. Explain why this solution is not very efficient (Hint: If <code>df$a[df$a == -99] &lt;- NA</code> has an error, how are you going to fix it? A solution is not scalable if it’s not automatable.</li>
</ul>
</div>
<div id="using-a-function" class="section level4" number="5.1.1.3">
<h4><span class="header-section-number">5.1.1.3</span> Using a function</h4>
<ul>
<li><p>Let’s recall what’s function in R: <code>input + computation + output</code></p></li>
<li><p>If you write a function, you gain efficiency because you don’t need to copy and paste the computation part.</p></li>
</ul>
<p>`
function(input){</p>
<p>computation</p>
<p>return(output)
}
`</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="functional-programming.html#cb34-1"></a><span class="co"># Function</span></span>
<span id="cb34-2"><a href="functional-programming.html#cb34-2"></a></span>
<span id="cb34-3"><a href="functional-programming.html#cb34-3"></a>fix_missing &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb34-4"><a href="functional-programming.html#cb34-4"></a>  x[x <span class="op">==</span><span class="st"> </span><span class="dv">-99</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb34-5"><a href="functional-programming.html#cb34-5"></a>  x</span>
<span id="cb34-6"><a href="functional-programming.html#cb34-6"></a>}</span>
<span id="cb34-7"><a href="functional-programming.html#cb34-7"></a></span>
<span id="cb34-8"><a href="functional-programming.html#cb34-8"></a><span class="co"># Apply function to each column (vector)</span></span>
<span id="cb34-9"><a href="functional-programming.html#cb34-9"></a></span>
<span id="cb34-10"><a href="functional-programming.html#cb34-10"></a>df<span class="op">$</span>a &lt;-<span class="st"> </span><span class="kw">fix_missing</span>(df<span class="op">$</span>a)</span>
<span id="cb34-11"><a href="functional-programming.html#cb34-11"></a>df<span class="op">$</span>b &lt;-<span class="st"> </span><span class="kw">fix_missing</span>(df<span class="op">$</span>b)</span>
<span id="cb34-12"><a href="functional-programming.html#cb34-12"></a>df<span class="op">$</span>c &lt;-<span class="st"> </span><span class="kw">fix_missing</span>(df<span class="op">$</span>c)</span>
<span id="cb34-13"><a href="functional-programming.html#cb34-13"></a>df<span class="op">$</span>d &lt;-<span class="st"> </span><span class="kw">fix_missing</span>(df<span class="op">$</span>d)</span>
<span id="cb34-14"><a href="functional-programming.html#cb34-14"></a></span>
<span id="cb34-15"><a href="functional-programming.html#cb34-15"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##       a     b     c     d
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     3     3     3     1
## 2     3     2     3     1
## 3     1    NA     1     2
## 4     1    NA     2     1
## 5    NA     1     1     3</code></pre>
<ul>
<li><p><strong>Challenge</strong> Why using function is more efficient than 100% copying and pasting? Can you think about a way we can automate the process?</p></li>
<li><p>Many options for automation in R: <code>for loop</code>, <code>apply</code> family, etc.</p></li>
<li><p>Here’s a tidy solution comes from <code>purrr</code> package.</p></li>
<li><p>The power and joy of one-liner.</p></li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="functional-programming.html#cb36-1"></a>df &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map_df</span>(df, fix_missing)</span>
<span id="cb36-2"><a href="functional-programming.html#cb36-2"></a></span>
<span id="cb36-3"><a href="functional-programming.html#cb36-3"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##       a     b     c     d
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     3     3     3     1
## 2     3     2     3     1
## 3     1    NA     1     2
## 4     1    NA     2     1
## 5    NA     1     1     3</code></pre>
<p><code>map()</code> is a <a href="https://en.wikipedia.org/wiki/Map_(higher-order_function)">higher-order function</a> that applies a given function to each element of a list/vector.</p>
<div class="figure">
<img src="https://d33wubrfki0l68.cloudfront.net/f0494d020aa517ae7b1011cea4c4a9f21702df8b/2577b/diagrams/functionals/map.png" alt="" />
<p class="caption">This is how map() works. It’s easier to understand with a picture.</p>
</div>
<pre><code>- Input: Takes a vector/list. 

- Computation: Calls the function once for each element of the vector 

- Output: Returns in a list or whatever data format you prefer (e.g., `_df helper: dataframe`)</code></pre>
<ul>
<li><strong>Challenge</strong> If you run the code below, what’s going to be the data type of the output?</li>
</ul>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="functional-programming.html#cb39-1"></a><span class="kw">map</span>(df, fix_missing)</span></code></pre></div>
<pre><code>## $a
## [1]  3  3  1  1 NA
## 
## $b
## [1]  3  2 NA NA  1
## 
## $c
## [1] 3 3 1 2 1
## 
## $d
## [1] 1 1 2 1 3</code></pre>
<ul>
<li>Why <code>map()</code> is a good alternative to <code>for loop</code>.</li>
</ul>

<iframe width="560" height="315" src="https://www.youtube.com/embed/bzUmK0Y07ck" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p>The Joy of Functional Programming (for Data Science) - Hadley Wickham</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="functional-programming.html#cb41-1"></a><span class="co"># Built-in data</span></span>
<span id="cb41-2"><a href="functional-programming.html#cb41-2"></a><span class="kw">data</span>(<span class="st">&quot;airquality&quot;</span>)</span>
<span id="cb41-3"><a href="functional-programming.html#cb41-3"></a></span>
<span id="cb41-4"><a href="functional-programming.html#cb41-4"></a><span class="kw">tic</span>()</span>
<span id="cb41-5"><a href="functional-programming.html#cb41-5"></a></span>
<span id="cb41-6"><a href="functional-programming.html#cb41-6"></a><span class="co"># Placeholder</span></span>
<span id="cb41-7"><a href="functional-programming.html#cb41-7"></a>out1 &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">ncol</span>(airquality))</span>
<span id="cb41-8"><a href="functional-programming.html#cb41-8"></a><span class="co"># Sequence variable</span></span>
<span id="cb41-9"><a href="functional-programming.html#cb41-9"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(airquality)) { <span class="co">#</span></span>
<span id="cb41-10"><a href="functional-programming.html#cb41-10"></a></span>
<span id="cb41-11"><a href="functional-programming.html#cb41-11"></a>  <span class="co"># Assign a computation result to each element</span></span>
<span id="cb41-12"><a href="functional-programming.html#cb41-12"></a>  out1[[i]] &lt;-<span class="st"> </span><span class="kw">mean</span>(airquality[[i]], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb41-13"><a href="functional-programming.html#cb41-13"></a>}</span>
<span id="cb41-14"><a href="functional-programming.html#cb41-14"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 0.008 sec elapsed</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="functional-programming.html#cb43-1"></a><span class="kw">tic</span>()</span>
<span id="cb43-2"><a href="functional-programming.html#cb43-2"></a>out1 &lt;-<span class="st"> </span>airquality <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb43-3"><a href="functional-programming.html#cb43-3"></a><span class="kw">toc</span>()</span></code></pre></div>
<pre><code>## 0.002 sec elapsed</code></pre>
<ul>
<li><p>In short, <code>map()</code> is more readable, faster, and easily extendable with other data science tasks (e.g., wrangling, modeling, and visualization) using <code>%&gt;%</code>.</p></li>
<li><p>Final point: Why not base R <code>apply</code> family?</p></li>
</ul>
<p>Short answer: <code>purrr::map()</code> is simpler to write. For instance,</p>
<p><code>map_dbl(x, mean, na.rm = TRUE)</code> = <code>vapply(x, mean, na.rm = TRUE, FUN.VALUE = double(1))</code></p>
</div>
<div id="application-many-models" class="section level4" number="5.1.1.4">
<h4><span class="header-section-number">5.1.1.4</span> Application (many models)</h4>
<ul>
<li>One popular application of <code>map()</code> is to run regression models (or whatever model you want to run) on list-columns. No more copying and pasting for running many regression models on subgroups!</li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="functional-programming.html#cb45-1"></a><span class="co"># Have you ever tried this?</span></span>
<span id="cb45-2"><a href="functional-programming.html#cb45-2"></a>lm_A &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="kw">subset</span>(data, subgroup <span class="op">==</span><span class="st"> &quot;group_A&quot;</span>))</span>
<span id="cb45-3"><a href="functional-programming.html#cb45-3"></a>lm_B &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="kw">subset</span>(data, subgroup <span class="op">==</span><span class="st"> &quot;group_B&quot;</span>))</span>
<span id="cb45-4"><a href="functional-programming.html#cb45-4"></a>lm_C &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="kw">subset</span>(data, subgroup <span class="op">==</span><span class="st"> &quot;group_C&quot;</span>))</span>
<span id="cb45-5"><a href="functional-programming.html#cb45-5"></a>lm_D &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="kw">subset</span>(data, subgroup <span class="op">==</span><span class="st"> &quot;group_D&quot;</span>))</span>
<span id="cb45-6"><a href="functional-programming.html#cb45-6"></a>lm_E &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="kw">subset</span>(data, subgroup <span class="op">==</span><span class="st"> &quot;group_E&quot;</span>))</span></code></pre></div>
<ul>
<li>For more information on this technique, read the Many Models subchapter of the <a href="https://r4ds.had.co.nz/many-models.html#creating-list-columns">R for Data Science</a>.</li>
</ul>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="functional-programming.html#cb46-1"></a><span class="co"># Function</span></span>
<span id="cb46-2"><a href="functional-programming.html#cb46-2"></a>lm_model &lt;-<span class="st"> </span><span class="cf">function</span>(df) {</span>
<span id="cb46-3"><a href="functional-programming.html#cb46-3"></a>  <span class="kw">lm</span>(Temp <span class="op">~</span><span class="st"> </span>Ozone, <span class="dt">data =</span> df)</span>
<span id="cb46-4"><a href="functional-programming.html#cb46-4"></a>}</span>
<span id="cb46-5"><a href="functional-programming.html#cb46-5"></a></span>
<span id="cb46-6"><a href="functional-programming.html#cb46-6"></a><span class="co"># Map</span></span>
<span id="cb46-7"><a href="functional-programming.html#cb46-7"></a>models &lt;-<span class="st"> </span>airquality <span class="op">%&gt;%</span></span>
<span id="cb46-8"><a href="functional-programming.html#cb46-8"></a><span class="st">  </span><span class="kw">group_by</span>(Month) <span class="op">%&gt;%</span></span>
<span id="cb46-9"><a href="functional-programming.html#cb46-9"></a><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Create list-columns</span></span>
<span id="cb46-10"><a href="functional-programming.html#cb46-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ols =</span> <span class="kw">map</span>(data, lm_model)) <span class="co"># Map</span></span>
<span id="cb46-11"><a href="functional-programming.html#cb46-11"></a>models<span class="op">$</span>ols[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [[1]]
## 
## Call:
## lm(formula = Temp ~ Ozone, data = df)
## 
## Coefficients:
## (Intercept)        Ozone  
##     62.8842       0.1629</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="functional-programming.html#cb48-1"></a><span class="co"># Add tidying</span></span>
<span id="cb48-2"><a href="functional-programming.html#cb48-2"></a>tidy_lm_model &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">compose</span>( <span class="co"># compose multiple functions</span></span>
<span id="cb48-3"><a href="functional-programming.html#cb48-3"></a>  broom<span class="op">::</span>tidy, <span class="co"># convert lm objects into tidy tibbles</span></span>
<span id="cb48-4"><a href="functional-programming.html#cb48-4"></a>  lm_model</span>
<span id="cb48-5"><a href="functional-programming.html#cb48-5"></a>)</span>
<span id="cb48-6"><a href="functional-programming.html#cb48-6"></a></span>
<span id="cb48-7"><a href="functional-programming.html#cb48-7"></a>tidied_models &lt;-<span class="st"> </span>airquality <span class="op">%&gt;%</span></span>
<span id="cb48-8"><a href="functional-programming.html#cb48-8"></a><span class="st">  </span><span class="kw">group_by</span>(Month) <span class="op">%&gt;%</span></span>
<span id="cb48-9"><a href="functional-programming.html#cb48-9"></a><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Create list-columns</span></span>
<span id="cb48-10"><a href="functional-programming.html#cb48-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ols =</span> <span class="kw">map</span>(data, tidy_lm_model))</span>
<span id="cb48-11"><a href="functional-programming.html#cb48-11"></a></span>
<span id="cb48-12"><a href="functional-programming.html#cb48-12"></a>tidied_models<span class="op">$</span>ols[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [[1]]
## # A tibble: 2 x 5
##   term        estimate std.error statistic  p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)   62.9      1.61       39.2  2.88e-23
## 2 Ozone          0.163    0.0500      3.26 3.31e- 3</code></pre>
</div>
</div>
</div>
<div id="automote-2-or-2-tasks" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Automote 2 or 2+ Tasks</h2>
<div id="objectives-1" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Objectives</h3>
<ul>
<li>Learning how to use <code>map2()</code> and <code>pmap()</code> to avoid writing nested loops.</li>
</ul>
</div>
<div id="problem" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Problem</h3>
<ul>
<li>Problem: How can you create something like below?</li>
</ul>
<p>[1] “University = Berkeley | Department = waterbenders”</p>
<p>[1] “University = Berkeley | Department = earthbenders”</p>
<p>[1] “University = Berkeley | Department = firebenders”</p>
<p>[1] “University = Berkeley | Department = airbenders”</p>
<p>[1] “University = Stanford | Department = waterbenders”</p>
<p>[1] “University = Stanford | Department = earthbenders”</p>
<p>[1] “University = Stanford | Department = firebenders”</p>
<p>[1] “University = Stanford | Department = airbenders”</p>
<ul>
<li>The most manual way: You can copy and paste eight times.</li>
</ul>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="functional-programming.html#cb50-1"></a><span class="kw">paste</span>(<span class="st">&quot;University = Berkeley | Department = CS&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;University = Berkeley | Department = CS&quot;</code></pre>
</div>
<div id="for-loop" class="section level3" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> For loop</h3>
<ul>
<li><p>A slightly more efficient way: using a for loop.</p></li>
<li><p>Think about which part of the statement is constant and which part varies ( = parameters).</p></li>
<li><p>Do we need a placeholder? No. We don’t need a placeholder because we don’t store the result of iterations.</p></li>
<li><p><strong>Challenge</strong>: How many parameters do you need to solve the problem below?</p></li>
</ul>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="functional-programming.html#cb52-1"></a><span class="co"># Outer loop</span></span>
<span id="cb52-2"><a href="functional-programming.html#cb52-2"></a></span>
<span id="cb52-3"><a href="functional-programming.html#cb52-3"></a><span class="cf">for</span> (univ <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;Berkeley&quot;</span>, <span class="st">&quot;Stanford&quot;</span>)) {</span>
<span id="cb52-4"><a href="functional-programming.html#cb52-4"></a></span>
<span id="cb52-5"><a href="functional-programming.html#cb52-5"></a>  <span class="co"># Inner loop</span></span>
<span id="cb52-6"><a href="functional-programming.html#cb52-6"></a></span>
<span id="cb52-7"><a href="functional-programming.html#cb52-7"></a>  <span class="cf">for</span> (dept <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;waterbenders&quot;</span>, <span class="st">&quot;earthbenders&quot;</span>, <span class="st">&quot;firebenders&quot;</span>, <span class="st">&quot;airbenders&quot;</span>)) {</span>
<span id="cb52-8"><a href="functional-programming.html#cb52-8"></a>    <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;University = &quot;</span>, univ, <span class="st">&quot;|&quot;</span>, <span class="st">&quot;Department = &quot;</span>, dept))</span>
<span id="cb52-9"><a href="functional-programming.html#cb52-9"></a>  }</span>
<span id="cb52-10"><a href="functional-programming.html#cb52-10"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;University =  Berkeley | Department =  waterbenders&quot;
## [1] &quot;University =  Berkeley | Department =  earthbenders&quot;
## [1] &quot;University =  Berkeley | Department =  firebenders&quot;
## [1] &quot;University =  Berkeley | Department =  airbenders&quot;
## [1] &quot;University =  Stanford | Department =  waterbenders&quot;
## [1] &quot;University =  Stanford | Department =  earthbenders&quot;
## [1] &quot;University =  Stanford | Department =  firebenders&quot;
## [1] &quot;University =  Stanford | Department =  airbenders&quot;</code></pre>
<ul>
<li>This is not bad, but … n arguments -&gt; n nested for loops. As a scale of your problem grows, your code gets really complicated.</li>
</ul>
<blockquote>
<p>To become significantly more reliable, code must become more transparent. In particular, nested conditions and loops must be viewed with great suspicion. Complicated control flows confuse programmers. Messy code often hides bugs. — <a href="https://en.wikipedia.org/wiki/Bjarne_Stroustrup">Bjarne Stroustrup</a></p>
</blockquote>
</div>
<div id="map2-pmap" class="section level3" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> map2 &amp; pmap</h3>
<ul>
<li><p>Step 1: Define inputs and a function.</p></li>
<li><p><strong>Challenge</strong> Why are we using <code>rep()</code> to create input vectors? For instance, for <code>univ_list</code> why not just use <code>c("Berkeley", "Stanford")</code>?</p></li>
</ul>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="functional-programming.html#cb54-1"></a><span class="co"># Inputs (remember the length of these inputs should be identical)</span></span>
<span id="cb54-2"><a href="functional-programming.html#cb54-2"></a></span>
<span id="cb54-3"><a href="functional-programming.html#cb54-3"></a>univ_list &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;Berkeley&quot;</span>, <span class="st">&quot;Stanford&quot;</span>), <span class="dv">4</span>)</span>
<span id="cb54-4"><a href="functional-programming.html#cb54-4"></a>dept_list &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;waterbenders&quot;</span>, <span class="st">&quot;earthbenders&quot;</span>, <span class="st">&quot;firebenders&quot;</span>, <span class="st">&quot;airbenders&quot;</span>), <span class="dv">2</span>)</span>
<span id="cb54-5"><a href="functional-programming.html#cb54-5"></a></span>
<span id="cb54-6"><a href="functional-programming.html#cb54-6"></a><span class="co"># Function</span></span>
<span id="cb54-7"><a href="functional-programming.html#cb54-7"></a></span>
<span id="cb54-8"><a href="functional-programming.html#cb54-8"></a>print_lists &lt;-<span class="st"> </span><span class="cf">function</span>(univ, dept) {</span>
<span id="cb54-9"><a href="functional-programming.html#cb54-9"></a>  <span class="kw">print</span>(<span class="kw">paste</span>(</span>
<span id="cb54-10"><a href="functional-programming.html#cb54-10"></a>    <span class="st">&quot;University = &quot;</span>, univ, <span class="st">&quot;|&quot;</span>,</span>
<span id="cb54-11"><a href="functional-programming.html#cb54-11"></a>    <span class="st">&quot;Department = &quot;</span>, dept</span>
<span id="cb54-12"><a href="functional-programming.html#cb54-12"></a>  ))</span>
<span id="cb54-13"><a href="functional-programming.html#cb54-13"></a>}</span>
<span id="cb54-14"><a href="functional-programming.html#cb54-14"></a></span>
<span id="cb54-15"><a href="functional-programming.html#cb54-15"></a><span class="co"># Test</span></span>
<span id="cb54-16"><a href="functional-programming.html#cb54-16"></a></span>
<span id="cb54-17"><a href="functional-programming.html#cb54-17"></a><span class="kw">print_lists</span>(univ_list[<span class="dv">1</span>], dept_list[<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] &quot;University =  Berkeley | Department =  waterbenders&quot;</code></pre>
<ul>
<li>Step2: Using <code>map2()</code> or <code>pmap()</code></li>
</ul>
<p><img src="https://dcl-prog.stanford.edu/images/map2.png" /></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="functional-programming.html#cb56-1"></a><span class="co"># 2 arguments</span></span>
<span id="cb56-2"><a href="functional-programming.html#cb56-2"></a>map2_output &lt;-<span class="st"> </span><span class="kw">map2</span>(univ_list, dept_list, print_lists)</span></code></pre></div>
<pre><code>## [1] &quot;University =  Berkeley | Department =  waterbenders&quot;
## [1] &quot;University =  Stanford | Department =  earthbenders&quot;
## [1] &quot;University =  Berkeley | Department =  firebenders&quot;
## [1] &quot;University =  Stanford | Department =  airbenders&quot;
## [1] &quot;University =  Berkeley | Department =  waterbenders&quot;
## [1] &quot;University =  Stanford | Department =  earthbenders&quot;
## [1] &quot;University =  Berkeley | Department =  firebenders&quot;
## [1] &quot;University =  Stanford | Department =  airbenders&quot;</code></pre>
<p><img src="https://d33wubrfki0l68.cloudfront.net/e426c5755e2e65bdcc073d387775db79791f32fd/92902/diagrams/functionals/pmap.png" /></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="functional-programming.html#cb58-1"></a><span class="co"># 3+ arguments</span></span>
<span id="cb58-2"><a href="functional-programming.html#cb58-2"></a>pmap_output &lt;-<span class="st"> </span><span class="kw">pmap</span>(<span class="kw">list</span>(univ_list, dept_list), print_lists)</span></code></pre></div>
<pre><code>## [1] &quot;University =  Berkeley | Department =  waterbenders&quot;
## [1] &quot;University =  Stanford | Department =  earthbenders&quot;
## [1] &quot;University =  Berkeley | Department =  firebenders&quot;
## [1] &quot;University =  Stanford | Department =  airbenders&quot;
## [1] &quot;University =  Berkeley | Department =  waterbenders&quot;
## [1] &quot;University =  Stanford | Department =  earthbenders&quot;
## [1] &quot;University =  Berkeley | Department =  firebenders&quot;
## [1] &quot;University =  Stanford | Department =  airbenders&quot;</code></pre>
<ul>
<li><strong>Challenge</strong> Have you noticed that we used a slightly different input for <code>pmap()</code> compared to <code>map()</code> or <code>map2()</code>? What is the difference?</li>
</ul>
</div>
</div>
<div id="automate-plotting" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Automate plotting</h2>
<div id="objective" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Objective</h3>
<ul>
<li>Learning how to use <code>map()</code> and <code>glue()</code> to automate creating multiple plots</li>
</ul>
</div>
<div id="problem-1" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Problem</h3>
<ul>
<li>Making the following data visualization process more efficient.</li>
</ul>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="functional-programming.html#cb60-1"></a><span class="kw">data</span>(<span class="st">&quot;airquality&quot;</span>)</span>
<span id="cb60-2"><a href="functional-programming.html#cb60-2"></a></span>
<span id="cb60-3"><a href="functional-programming.html#cb60-3"></a>airquality <span class="op">%&gt;%</span></span>
<span id="cb60-4"><a href="functional-programming.html#cb60-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Ozone, <span class="dt">y =</span> Solar.R)) <span class="op">+</span></span>
<span id="cb60-5"><a href="functional-programming.html#cb60-5"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb60-6"><a href="functional-programming.html#cb60-6"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb60-7"><a href="functional-programming.html#cb60-7"></a>    <span class="dt">title =</span> <span class="st">&quot;Relationship between Ozone and Solar.R&quot;</span>,</span>
<span id="cb60-8"><a href="functional-programming.html#cb60-8"></a>    <span class="dt">y =</span> <span class="st">&quot;Solar.R&quot;</span></span>
<span id="cb60-9"><a href="functional-programming.html#cb60-9"></a>  )</span></code></pre></div>
<pre><code>## Warning: Removed 42 rows containing missing values (geom_point).</code></pre>
<p><img src="03_functional_programming_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="functional-programming.html#cb62-1"></a>airquality <span class="op">%&gt;%</span></span>
<span id="cb62-2"><a href="functional-programming.html#cb62-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Ozone, <span class="dt">y =</span> Wind)) <span class="op">+</span></span>
<span id="cb62-3"><a href="functional-programming.html#cb62-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb62-4"><a href="functional-programming.html#cb62-4"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb62-5"><a href="functional-programming.html#cb62-5"></a>    <span class="dt">title =</span> <span class="st">&quot;Relationship between Ozone and Wind&quot;</span>,</span>
<span id="cb62-6"><a href="functional-programming.html#cb62-6"></a>    <span class="dt">y =</span> <span class="st">&quot;Wind&quot;</span></span>
<span id="cb62-7"><a href="functional-programming.html#cb62-7"></a>  )</span></code></pre></div>
<pre><code>## Warning: Removed 37 rows containing missing values (geom_point).</code></pre>
<p><img src="03_functional_programming_files/figure-html/unnamed-chunk-16-2.png" width="672" /></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="functional-programming.html#cb64-1"></a>airquality <span class="op">%&gt;%</span></span>
<span id="cb64-2"><a href="functional-programming.html#cb64-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Ozone, <span class="dt">y =</span> Temp)) <span class="op">+</span></span>
<span id="cb64-3"><a href="functional-programming.html#cb64-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb64-4"><a href="functional-programming.html#cb64-4"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb64-5"><a href="functional-programming.html#cb64-5"></a>    <span class="dt">title =</span> <span class="st">&quot;Relationship between Ozone and Temp&quot;</span>,</span>
<span id="cb64-6"><a href="functional-programming.html#cb64-6"></a>    <span class="dt">y =</span> <span class="st">&quot;Temp&quot;</span></span>
<span id="cb64-7"><a href="functional-programming.html#cb64-7"></a>  )</span></code></pre></div>
<pre><code>## Warning: Removed 37 rows containing missing values (geom_point).</code></pre>
<p><img src="03_functional_programming_files/figure-html/unnamed-chunk-16-3.png" width="672" /></p>
</div>
<div id="solution" class="section level3" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> Solution</h3>
<ul>
<li>Learn how <code>glue()</code> works.</li>
<li><code>glue()</code> combines strings and objects and it works simpler and faster than <code>paste()</code> or <code>sprintif()</code>.</li>
</ul>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="functional-programming.html#cb66-1"></a>names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Jae&quot;</span>, <span class="st">&quot;Aniket&quot;</span>, <span class="st">&quot;Avery&quot;</span>)</span>
<span id="cb66-2"><a href="functional-programming.html#cb66-2"></a></span>
<span id="cb66-3"><a href="functional-programming.html#cb66-3"></a>fields &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Political Science&quot;</span>, <span class="st">&quot;Law&quot;</span>, <span class="st">&quot;Public Health&quot;</span>)</span>
<span id="cb66-4"><a href="functional-programming.html#cb66-4"></a></span>
<span id="cb66-5"><a href="functional-programming.html#cb66-5"></a><span class="kw">glue</span>(<span class="st">&quot;{names} studies {fields}.&quot;</span>)</span></code></pre></div>
<pre><code>## Jae studies Political Science.
## Aniket studies Law.
## Avery studies Public Health.</code></pre>
<ul>
<li><p>So, our next step is to combine <code>glue()</code> and <code>map()</code>.</p></li>
<li><p>Let’s first think about writing a function that includes <code>glue()</code>.</p></li>
<li><p><strong>Challenge</strong>
How can you create the character vector of column names?</p></li>
<li><p><strong>Challenge</strong>
How can you make <code>ggplot2()</code> take strings as x and y variable names? (Hint: Type <code>?aes_string()</code>)</p></li>
</ul>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="functional-programming.html#cb68-1"></a>airquality <span class="op">%&gt;%</span></span>
<span id="cb68-2"><a href="functional-programming.html#cb68-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes_string</span>(<span class="dt">x =</span> <span class="kw">names</span>(airquality)[<span class="dv">1</span>], <span class="dt">y =</span> <span class="kw">names</span>(airquality)[<span class="dv">2</span>])) <span class="op">+</span></span>
<span id="cb68-3"><a href="functional-programming.html#cb68-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb68-4"><a href="functional-programming.html#cb68-4"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb68-5"><a href="functional-programming.html#cb68-5"></a>    <span class="dt">title =</span> <span class="kw">glue</span>(<span class="st">&quot;Relationship between Ozone and {names(airquality)[2]}&quot;</span>),</span>
<span id="cb68-6"><a href="functional-programming.html#cb68-6"></a>    <span class="dt">y =</span> <span class="kw">glue</span>(<span class="st">&quot;{names(airquality)[2]}&quot;</span>)</span>
<span id="cb68-7"><a href="functional-programming.html#cb68-7"></a>  )</span></code></pre></div>
<pre><code>## Warning: Removed 42 rows containing missing values (geom_point).</code></pre>
<p><img src="03_functional_programming_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<ul>
<li><p>The next step is to write an automatic plotting function.</p>
<ul>
<li>Note that in the function argument <code>i</code> (abstract) replaced 2 (specific): abstraction</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="functional-programming.html#cb70-1"></a>create_point_plot &lt;-<span class="st"> </span><span class="cf">function</span>(i) {</span>
<span id="cb70-2"><a href="functional-programming.html#cb70-2"></a>  airquality <span class="op">%&gt;%</span></span>
<span id="cb70-3"><a href="functional-programming.html#cb70-3"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes_string</span>(<span class="dt">x =</span> <span class="kw">names</span>(airquality)[<span class="dv">1</span>], <span class="dt">y =</span> <span class="kw">names</span>(airquality)[i])) <span class="op">+</span></span>
<span id="cb70-4"><a href="functional-programming.html#cb70-4"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb70-5"><a href="functional-programming.html#cb70-5"></a><span class="st">    </span><span class="kw">labs</span>(</span>
<span id="cb70-6"><a href="functional-programming.html#cb70-6"></a>      <span class="dt">title =</span> <span class="kw">glue</span>(<span class="st">&quot;Relationship between Ozone and {names(airquality)[i]}&quot;</span>),</span>
<span id="cb70-7"><a href="functional-programming.html#cb70-7"></a>      <span class="dt">y =</span> <span class="kw">glue</span>(<span class="st">&quot;{names(airquality)[i]}&quot;</span>)</span>
<span id="cb70-8"><a href="functional-programming.html#cb70-8"></a>    )</span>
<span id="cb70-9"><a href="functional-programming.html#cb70-9"></a>}</span></code></pre></div>
<ul>
<li>The final step is to put the function in <code>map()</code>.</li>
</ul>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="functional-programming.html#cb71-1"></a><span class="kw">map</span>(<span class="dv">2</span><span class="op">:</span><span class="kw">ncol</span>(airquality), create_point_plot)</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<pre><code>## Warning: Removed 42 rows containing missing values (geom_point).</code></pre>
<p><img src="03_functional_programming_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<pre><code>## Warning: Removed 37 rows containing missing values (geom_point).</code></pre>
<p><img src="03_functional_programming_files/figure-html/unnamed-chunk-20-2.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<pre><code>## Warning: Removed 37 rows containing missing values (geom_point).</code></pre>
<p><img src="03_functional_programming_files/figure-html/unnamed-chunk-20-3.png" width="672" /></p>
<pre><code>## 
## [[4]]</code></pre>
<pre><code>## Warning: Removed 37 rows containing missing values (geom_point).</code></pre>
<p><img src="03_functional_programming_files/figure-html/unnamed-chunk-20-4.png" width="672" /></p>
<pre><code>## 
## [[5]]</code></pre>
<pre><code>## Warning: Removed 37 rows containing missing values (geom_point).</code></pre>
<p><img src="03_functional_programming_files/figure-html/unnamed-chunk-20-5.png" width="672" /></p>
</div>
</div>
<div id="automate-joining" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Automate joining</h2>
<div id="objective-1" class="section level3" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> Objective</h3>
<ul>
<li>Learning how to use <code>reduce()</code> to automate joining multiple dataframes</li>
</ul>
</div>
<div id="problem-2" class="section level3" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> Problem</h3>
<ul>
<li>How can you make joining multiple dataframes more efficient?</li>
<li>Note that we will use <code>dplyr::left_join() = merge(x, y, all.x = TRUE)</code>.</li>
</ul>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="functional-programming.html#cb82-1"></a>df1 &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb82-2"><a href="functional-programming.html#cb82-2"></a>  <span class="dt">x =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</span>
<span id="cb82-3"><a href="functional-programming.html#cb82-3"></a>  <span class="dt">y =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</span>
<span id="cb82-4"><a href="functional-programming.html#cb82-4"></a>  <span class="dt">z =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb82-5"><a href="functional-programming.html#cb82-5"></a>)</span>
<span id="cb82-6"><a href="functional-programming.html#cb82-6"></a></span>
<span id="cb82-7"><a href="functional-programming.html#cb82-7"></a>df2 &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb82-8"><a href="functional-programming.html#cb82-8"></a>  <span class="dt">x =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</span>
<span id="cb82-9"><a href="functional-programming.html#cb82-9"></a>  <span class="dt">y =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</span>
<span id="cb82-10"><a href="functional-programming.html#cb82-10"></a>  <span class="dt">z =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb82-11"><a href="functional-programming.html#cb82-11"></a>)</span>
<span id="cb82-12"><a href="functional-programming.html#cb82-12"></a></span>
<span id="cb82-13"><a href="functional-programming.html#cb82-13"></a>df3 &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb82-14"><a href="functional-programming.html#cb82-14"></a>  <span class="dt">x =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</span>
<span id="cb82-15"><a href="functional-programming.html#cb82-15"></a>  <span class="dt">y =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),</span>
<span id="cb82-16"><a href="functional-programming.html#cb82-16"></a>  <span class="dt">z =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb82-17"><a href="functional-programming.html#cb82-17"></a>)</span></code></pre></div>
</div>
<div id="copy-and-paste" class="section level3" number="5.4.3">
<h3><span class="header-section-number">5.4.3</span> Copy and paste</h3>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="functional-programming.html#cb83-1"></a>first_join &lt;-<span class="st"> </span><span class="kw">left_join</span>(df1, df2)</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;x&quot;, &quot;y&quot;, &quot;z&quot;)</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="functional-programming.html#cb85-1"></a>second_join &lt;-<span class="st"> </span><span class="kw">left_join</span>(first_join, df3)</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;x&quot;, &quot;y&quot;, &quot;z&quot;)</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="functional-programming.html#cb87-1"></a>second_join</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##       x     y     z
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     8     5     8
## 2     4     8     3
## 3     4     4     4</code></pre>
<ul>
<li><strong>Challenge</strong>
Why the above solution is not efficient?</li>
</ul>
</div>
<div id="reduce" class="section level3" number="5.4.4">
<h3><span class="header-section-number">5.4.4</span> reduce</h3>
<div class="figure">
<img src="https://d33wubrfki0l68.cloudfront.net/9c239e1227c69b7a2c9c2df234c21f3e1c74dd57/eec0e/diagrams/functionals/reduce.png" alt="" />
<p class="caption">How reduce() works.</p>
</div>
<pre><code>- Input: Takes a vector of length n

- Computation: Calls a function with a pair of values at a time

- Output: Returns a vector of length 1</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="functional-programming.html#cb90-1"></a>reduced &lt;-<span class="st"> </span><span class="kw">reduce</span>(<span class="kw">list</span>(df1, df2, df3), left_join)</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;x&quot;, &quot;y&quot;, &quot;z&quot;)
## Joining, by = c(&quot;x&quot;, &quot;y&quot;, &quot;z&quot;)</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="functional-programming.html#cb92-1"></a>reduced</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##       x     y     z
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     8     5     8
## 2     4     8     3
## 3     4     4     4</code></pre>
</div>
</div>
<div id="make-automation-slower-or-faster" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> Make automation slower or faster</h2>
<div id="objectives-2" class="section level3" number="5.5.1">
<h3><span class="header-section-number">5.5.1</span> Objectives</h3>
<ul>
<li>Learning how to use <code>slowly()</code> and <code>future_</code> to make automation process either slower or faster</li>
</ul>
</div>
<div id="how-to-make-automation-slower" class="section level3" number="5.5.2">
<h3><span class="header-section-number">5.5.2</span> How to make automation slower</h3>
<ul>
<li>Scraping 50 pages from a website and you don’t want to overload the server. How can you do that?</li>
</ul>
</div>
<div id="for-loop-1" class="section level3" number="5.5.3">
<h3><span class="header-section-number">5.5.3</span> For loop</h3>
</div>
<div id="map" class="section level3" number="5.5.4">
<h3><span class="header-section-number">5.5.4</span> Map</h3>
<ul>
<li><p><code>walk()</code> works same as <code>map()</code> but doesn’t store its output.</p></li>
<li><p>If you’re web scraping, one problem with this approach is it’s too fast by human standards.</p></li>
<li><p>If you want to make the function run slowly …</p></li>
</ul>
<blockquote>
<p>slowly() takes a function and modifies it to wait a given amount of time between each call. - <code>purrr</code> package vignette
- If a function is a verb, then a helper function is an adverb (modifying the behavior of the verb).</p>
</blockquote>
</div>
<div id="how-to-make-automation-faster" class="section level3" number="5.5.5">
<h3><span class="header-section-number">5.5.5</span> How to make automation Faster</h3>
<p>In a different situation, you want to make your function run faster. This is a common situation when you collect and analyze data at large-scale. You can solve this problem using parallel processing. For more on the parallel processing in R, read <a href="https://yxue-me.com/post/2019-05-12-a-glossary-of-parallel-computing-packages-in-r-2019/">this review</a>.</p>
<ul>
<li><p>Parallel processing setup</p>
<ul>
<li><p>Step1: Determine the number of max workers (<code>availableCores()</code>)</p></li>
<li><p>Step2: Determine the parallel processing mode (<code>plan()</code>)</p></li>
</ul></li>
</ul>
</div>
</div>
<div id="make-error-handling-easier" class="section level2" number="5.6">
<h2><span class="header-section-number">5.6</span> Make error handling easier</h2>
<div id="learning-objective" class="section level3" number="5.6.1">
<h3><span class="header-section-number">5.6.1</span> Learning objective</h3>
<ul>
<li><p>Learning how to use <code>safely()</code> and <code>possibly()</code> to make error handling easier
### Problem</p></li>
<li><p><strong>Challenge</strong></p></li>
<li><p>Explain why we can’t run <code>map(url_lists, read_html)</code></p></li>
</ul>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="functional-programming.html#cb94-1"></a>url_lists &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb94-2"><a href="functional-programming.html#cb94-2"></a>  <span class="st">&quot;https://en.wikipedia.org/wiki/University_of_California,_Berkeley&quot;</span>,</span>
<span id="cb94-3"><a href="functional-programming.html#cb94-3"></a>  <span class="st">&quot;https://en.wikipedia.org/wiki/Stanford_University&quot;</span>,</span>
<span id="cb94-4"><a href="functional-programming.html#cb94-4"></a>  <span class="st">&quot;https://en.wikipedia.org/wiki/Carnegie_Mellon_University&quot;</span>,</span>
<span id="cb94-5"><a href="functional-programming.html#cb94-5"></a>  <span class="st">&quot;https://DLAB&quot;</span></span>
<span id="cb94-6"><a href="functional-programming.html#cb94-6"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="functional-programming.html#cb95-1"></a><span class="kw">map</span>(url_lists, read_html)</span></code></pre></div>
<ul>
<li>This is a very simple problem so it’s easy to tell where the problem is. How can you make your error more informative?</li>
</ul>
</div>
<div id="solution-1" class="section level3" number="5.6.2">
<h3><span class="header-section-number">5.6.2</span> Solution</h3>
<div id="try-catch" class="section level4" number="5.6.2.1">
<h4><span class="header-section-number">5.6.2.1</span> Try-catch</h4>
<ul>
<li><p>There are three kinds of messages you will run into, if your code has an error based on the following functions.</p>
<ul>
<li>stop(): errors; Functions must stop.</li>
<li>warning(): warnings; Functions may still work. Nonetheless, something is possibly messed up.</li>
<li>message(): messages; Some actions happened.</li>
</ul></li>
<li><p>The basic logic of <code>try-catch</code>, R’s basic error handling function, works like the following.</p></li>
</ul>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="functional-programming.html#cb96-1"></a><span class="kw">tryCatch</span>(</span>
<span id="cb96-2"><a href="functional-programming.html#cb96-2"></a>  {</span>
<span id="cb96-3"><a href="functional-programming.html#cb96-3"></a>    <span class="kw">map</span>(url_lists, read_html)</span>
<span id="cb96-4"><a href="functional-programming.html#cb96-4"></a>  },</span>
<span id="cb96-5"><a href="functional-programming.html#cb96-5"></a>  <span class="dt">warning =</span> <span class="cf">function</span>(w) {</span>
<span id="cb96-6"><a href="functional-programming.html#cb96-6"></a>    <span class="st">&quot;Warning&quot;</span></span>
<span id="cb96-7"><a href="functional-programming.html#cb96-7"></a>  },</span>
<span id="cb96-8"><a href="functional-programming.html#cb96-8"></a>  <span class="dt">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb96-9"><a href="functional-programming.html#cb96-9"></a>    <span class="st">&quot;Error&quot;</span></span>
<span id="cb96-10"><a href="functional-programming.html#cb96-10"></a>  },</span>
<span id="cb96-11"><a href="functional-programming.html#cb96-11"></a>  <span class="dt">finally =</span> {</span>
<span id="cb96-12"><a href="functional-programming.html#cb96-12"></a>    <span class="st">&quot;Message&quot;</span></span>
<span id="cb96-13"><a href="functional-programming.html#cb96-13"></a>  }</span>
<span id="cb96-14"><a href="functional-programming.html#cb96-14"></a>)</span></code></pre></div>
<pre><code>## [1] &quot;Error&quot;</code></pre>
<ul>
<li>Here’s <code>purrr</code> version of the <code>try-catch</code> mechanism (evaluates code and assigns exception handlers).</li>
</ul>
</div>
<div id="safely" class="section level4" number="5.6.2.2">
<h4><span class="header-section-number">5.6.2.2</span> safely</h4>
<p><strong>Outputs</strong></p>
<ul>
<li>result: result or <code>NULL</code></li>
<li>error: <code>NULL</code> or <code>error</code></li>
</ul>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="functional-programming.html#cb98-1"></a><span class="kw">map</span>(url_lists, <span class="kw">safely</span>(read_html))</span></code></pre></div>
<pre><code>## [[1]]
## [[1]]$result
## {html_document}
## &lt;html class=&quot;client-nojs&quot; lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;
## [1] &lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8 ...
## [2] &lt;body class=&quot;mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject  ...
## 
## [[1]]$error
## NULL
## 
## 
## [[2]]
## [[2]]$result
## {html_document}
## &lt;html class=&quot;client-nojs&quot; lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;
## [1] &lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8 ...
## [2] &lt;body class=&quot;mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject  ...
## 
## [[2]]$error
## NULL
## 
## 
## [[3]]
## [[3]]$result
## {html_document}
## &lt;html class=&quot;client-nojs&quot; lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;
## [1] &lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8 ...
## [2] &lt;body class=&quot;mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject  ...
## 
## [[3]]$error
## NULL
## 
## 
## [[4]]
## [[4]]$result
## NULL
## 
## [[4]]$error
## &lt;simpleError in open.connection(x, &quot;rb&quot;): Could not resolve host: DLAB&gt;</code></pre>
<ul>
<li>The easier way to solve this problem is just avoiding the error.</li>
</ul>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="functional-programming.html#cb100-1"></a><span class="kw">map</span>(url_lists, <span class="kw">safely</span>(read_html)) <span class="op">%&gt;%</span></span>
<span id="cb100-2"><a href="functional-programming.html#cb100-2"></a><span class="st">  </span><span class="kw">map</span>(<span class="st">&quot;result&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb100-3"><a href="functional-programming.html#cb100-3"></a><span class="st">  </span><span class="co"># = map(function(x) x[[&quot;result&quot;]]) = map(~.x[[&quot;name&quot;]])</span></span>
<span id="cb100-4"><a href="functional-programming.html#cb100-4"></a><span class="st">  </span>purrr<span class="op">::</span><span class="kw">compact</span>() <span class="co"># Remove empty elements</span></span></code></pre></div>
<pre><code>## [[1]]
## {html_document}
## &lt;html class=&quot;client-nojs&quot; lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;
## [1] &lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8 ...
## [2] &lt;body class=&quot;mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject  ...
## 
## [[2]]
## {html_document}
## &lt;html class=&quot;client-nojs&quot; lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;
## [1] &lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8 ...
## [2] &lt;body class=&quot;mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject  ...
## 
## [[3]]
## {html_document}
## &lt;html class=&quot;client-nojs&quot; lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;
## [1] &lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8 ...
## [2] &lt;body class=&quot;mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject  ...</code></pre>
</div>
<div id="possibly" class="section level4" number="5.6.2.3">
<h4><span class="header-section-number">5.6.2.3</span> possibly</h4>
<p>What if the best way to solve the problem is not ignoring the error …</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="functional-programming.html#cb102-1"></a><span class="co"># If error occurred, &quot;The URL is broken.&quot; will be stored in that element(s).</span></span>
<span id="cb102-2"><a href="functional-programming.html#cb102-2"></a>out &lt;-<span class="st"> </span><span class="kw">map</span>(</span>
<span id="cb102-3"><a href="functional-programming.html#cb102-3"></a>  url_lists,</span>
<span id="cb102-4"><a href="functional-programming.html#cb102-4"></a>  <span class="kw">possibly</span>(read_html,</span>
<span id="cb102-5"><a href="functional-programming.html#cb102-5"></a>    <span class="dt">otherwise =</span> <span class="st">&quot;The URL is broken.&quot;</span></span>
<span id="cb102-6"><a href="functional-programming.html#cb102-6"></a>  )</span>
<span id="cb102-7"><a href="functional-programming.html#cb102-7"></a>)</span>
<span id="cb102-8"><a href="functional-programming.html#cb102-8"></a></span>
<span id="cb102-9"><a href="functional-programming.html#cb102-9"></a><span class="co"># Let&#39;s find the broken URL.</span></span>
<span id="cb102-10"><a href="functional-programming.html#cb102-10"></a>url_lists[out[<span class="kw">seq</span>(out)] <span class="op">==</span><span class="st"> &quot;The URL is broken.&quot;</span>]</span></code></pre></div>
<pre><code>## [1] &quot;https://DLAB&quot;</code></pre>
</div>
</div>
</div>
<div id="developing-your-own-data-tools" class="section level2" number="5.7">
<h2><span class="header-section-number">5.7</span> Developing your own data tools</h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tidy-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="semi-structured-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
