<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Big data | Computational Thinking for Social Scientists</title>
  <meta name="description" content="Chapter 8 Big data | Computational Thinking for Social Scientists. Online textbook for Teaching Computational Tools and Techniques for Social Scientists." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Big data | Computational Thinking for Social Scientists" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Chapter 8 Big data | Computational Thinking for Social Scientists. Online textbook for Teaching Computational Tools and Techniques for Social Scientists." />
  <meta name="github-repo" content="jaeyk/PS239T" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Big data | Computational Thinking for Social Scientists" />
  <meta name="twitter:site" content="@JaeJaeykim2" />
  <meta name="twitter:description" content="Chapter 8 Big data | Computational Thinking for Social Scientists. Online textbook for Teaching Computational Tools and Techniques for Social Scientists." />
  

<meta name="author" content="Jae Yeon Kim" />


<meta name="date" content="2020-10-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="machine-learning.html"/>

<script src="libs/header-attrs-2.4/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />
<script src="libs/tabwid-1.0.0/tabwid.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Computational Thinking for Social Scientists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Hello World</a>
<ul>
<li class="chapter" data-level="1.0.1" data-path="index.html"><a href="index.html#part-i-fundamentals"><i class="fa fa-check"></i><b>1.0.1</b> Part I Fundamentals</a></li>
<li class="chapter" data-level="1.0.2" data-path="index.html"><a href="index.html#part-ii-applications"><i class="fa fa-check"></i><b>1.0.2</b> Part II Applications</a></li>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#special-thanks"><i class="fa fa-check"></i><b>1.1</b> Special thanks</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i><b>1.2</b> License</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="motivation.html"><a href="motivation.html"><i class="fa fa-check"></i><b>2</b> Computational thinking</a>
<ul>
<li class="chapter" data-level="2.1" data-path="motivation.html"><a href="motivation.html#why-computational-thinking"><i class="fa fa-check"></i><b>2.1</b> Why computational thinking</a></li>
<li class="chapter" data-level="2.2" data-path="motivation.html"><a href="motivation.html#computational-way-of-thinking-about-data"><i class="fa fa-check"></i><b>2.2</b> Computational way of thinking about data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="motivation.html"><a href="motivation.html#structure"><i class="fa fa-check"></i><b>2.2.1</b> Structure</a></li>
<li class="chapter" data-level="2.2.2" data-path="motivation.html"><a href="motivation.html#dimension"><i class="fa fa-check"></i><b>2.2.2</b> Dimension</a></li>
<li class="chapter" data-level="2.2.3" data-path="motivation.html"><a href="motivation.html#size"><i class="fa fa-check"></i><b>2.2.3</b> Size</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="motivation.html"><a href="motivation.html#computational-way-of-thinking-about-research-process"><i class="fa fa-check"></i><b>2.3</b> Computational way of thinking about research process</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>3</b> Managing data and code</a>
<ul>
<li class="chapter" data-level="3.1" data-path="intro.html"><a href="intro.html#project-oriented-research"><i class="fa fa-check"></i><b>3.1</b> Project-oriented research</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="intro.html"><a href="intro.html#computational-reproducibility"><i class="fa fa-check"></i><b>3.1.1</b> Computational reproducibility</a></li>
<li class="chapter" data-level="3.1.2" data-path="intro.html"><a href="intro.html#version-control-git-and-bash"><i class="fa fa-check"></i><b>3.1.2</b> Version control (Git and Bash)</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="intro.html"><a href="intro.html#writing-code-how-to-code-like-a-professional"><i class="fa fa-check"></i><b>3.2</b> Writing code: How to code like a professional</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="intro.html"><a href="intro.html#write-readable-code"><i class="fa fa-check"></i><b>3.2.1</b> Write readable code</a></li>
<li class="chapter" data-level="3.2.2" data-path="intro.html"><a href="intro.html#write-reusable-code"><i class="fa fa-check"></i><b>3.2.2</b> Write reusable code</a></li>
<li class="chapter" data-level="3.2.3" data-path="intro.html"><a href="intro.html#test-your-code-systematically"><i class="fa fa-check"></i><b>3.2.3</b> Test your code systematically</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="intro.html"><a href="intro.html#asking-questions-minimal-reproducible-example"><i class="fa fa-check"></i><b>3.3</b> Asking questions: Minimal reproducible example</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="intro.html"><a href="intro.html#how-to-create-a-minimal-reproducible-example"><i class="fa fa-check"></i><b>3.3.1</b> How to create a minimal reproducible example</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="intro.html"><a href="intro.html#references"><i class="fa fa-check"></i><b>3.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tidy-data.html"><a href="tidy-data.html"><i class="fa fa-check"></i><b>4</b> Tidy data and its friends</a>
<ul>
<li class="chapter" data-level="4.1" data-path="intro.html"><a href="intro.html#setup"><i class="fa fa-check"></i><b>4.1</b> Setup</a></li>
<li class="chapter" data-level="4.2" data-path="tidy-data.html"><a href="tidy-data.html#r-data-structures"><i class="fa fa-check"></i><b>4.2</b> R Data structures</a></li>
<li class="chapter" data-level="4.3" data-path="tidy-data.html"><a href="tidy-data.html#d-data-vectors"><i class="fa fa-check"></i><b>4.3</b> 1D data: Vectors</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="tidy-data.html"><a href="tidy-data.html#atomic-classes"><i class="fa fa-check"></i><b>4.3.1</b> Atomic classes</a></li>
<li class="chapter" data-level="4.3.2" data-path="tidy-data.html"><a href="tidy-data.html#data-structures"><i class="fa fa-check"></i><b>4.3.2</b> Data structures</a></li>
<li class="chapter" data-level="4.3.3" data-path="tidy-data.html"><a href="tidy-data.html#attributes"><i class="fa fa-check"></i><b>4.3.3</b> Attributes</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="tidy-data.html"><a href="tidy-data.html#d-data-matrices-and-dataframes"><i class="fa fa-check"></i><b>4.4</b> 2D data: matrices and dataframes</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="tidy-data.html"><a href="tidy-data.html#matrices"><i class="fa fa-check"></i><b>4.4.1</b> Matrices</a></li>
<li class="chapter" data-level="4.4.2" data-path="tidy-data.html"><a href="tidy-data.html#dataframes"><i class="fa fa-check"></i><b>4.4.2</b> Dataframes</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="tidy-data.html"><a href="tidy-data.html#subset"><i class="fa fa-check"></i><b>4.5</b> Subset</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="tidy-data.html"><a href="tidy-data.html#atomic-vectors"><i class="fa fa-check"></i><b>4.5.1</b> Atomic vectors</a></li>
<li class="chapter" data-level="4.5.2" data-path="tidy-data.html"><a href="tidy-data.html#lists-1"><i class="fa fa-check"></i><b>4.5.2</b> Lists</a></li>
<li class="chapter" data-level="4.5.3" data-path="tidy-data.html"><a href="tidy-data.html#matrices-1"><i class="fa fa-check"></i><b>4.5.3</b> Matrices</a></li>
<li class="chapter" data-level="4.5.4" data-path="tidy-data.html"><a href="tidy-data.html#data-frames"><i class="fa fa-check"></i><b>4.5.4</b> Data frames</a></li>
<li class="chapter" data-level="4.5.5" data-path="tidy-data.html"><a href="tidy-data.html#subsetting-operators"><i class="fa fa-check"></i><b>4.5.5</b> Subsetting operators</a></li>
<li class="chapter" data-level="4.5.6" data-path="tidy-data.html"><a href="tidy-data.html#subassignment"><i class="fa fa-check"></i><b>4.5.6</b> Subassignment</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="tidy-data.html"><a href="tidy-data.html#tidyverse"><i class="fa fa-check"></i><b>4.6</b> Tidyverse</a></li>
<li class="chapter" data-level="4.7" data-path="tidy-data.html"><a href="tidy-data.html#tidy-data"><i class="fa fa-check"></i><b>4.7</b> Tidy data</a></li>
<li class="chapter" data-level="4.8" data-path="tidy-data.html"><a href="tidy-data.html#tidyr"><i class="fa fa-check"></i><b>4.8</b> tidyr</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="tidy-data.html"><a href="tidy-data.html#reshaping"><i class="fa fa-check"></i><b>4.8.1</b> Reshaping</a></li>
<li class="chapter" data-level="4.8.2" data-path="tidy-data.html"><a href="tidy-data.html#filling-tbd"><i class="fa fa-check"></i><b>4.8.2</b> Filling (TBD)</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="tidy-data.html"><a href="tidy-data.html#dplyr"><i class="fa fa-check"></i><b>4.9</b> dplyr</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="tidy-data.html"><a href="tidy-data.html#rearranging"><i class="fa fa-check"></i><b>4.9.1</b> Rearranging</a></li>
<li class="chapter" data-level="4.9.2" data-path="tidy-data.html"><a href="tidy-data.html#subset-observations-rows"><i class="fa fa-check"></i><b>4.9.2</b> Subset observations (rows)</a></li>
<li class="chapter" data-level="4.9.3" data-path="tidy-data.html"><a href="tidy-data.html#subset-variables-columns"><i class="fa fa-check"></i><b>4.9.3</b> Subset variables (columns)</a></li>
<li class="chapter" data-level="4.9.4" data-path="tidy-data.html"><a href="tidy-data.html#create-variables-tbd"><i class="fa fa-check"></i><b>4.9.4</b> Create variables (TBD)</a></li>
<li class="chapter" data-level="4.9.5" data-path="tidy-data.html"><a href="tidy-data.html#rename-variables-tbd"><i class="fa fa-check"></i><b>4.9.5</b> Rename variables (TBD)</a></li>
<li class="chapter" data-level="4.9.6" data-path="tidy-data.html"><a href="tidy-data.html#recode-values-tbd"><i class="fa fa-check"></i><b>4.9.6</b> Recode values (TBD)</a></li>
<li class="chapter" data-level="4.9.7" data-path="tidy-data.html"><a href="tidy-data.html#counting"><i class="fa fa-check"></i><b>4.9.7</b> Counting</a></li>
<li class="chapter" data-level="4.9.8" data-path="tidy-data.html"><a href="tidy-data.html#summarizing"><i class="fa fa-check"></i><b>4.9.8</b> Summarizing</a></li>
<li class="chapter" data-level="4.9.9" data-path="tidy-data.html"><a href="tidy-data.html#grouping"><i class="fa fa-check"></i><b>4.9.9</b> Grouping</a></li>
<li class="chapter" data-level="4.9.10" data-path="tidy-data.html"><a href="tidy-data.html#joining"><i class="fa fa-check"></i><b>4.9.10</b> Joining</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="tidy-data.html"><a href="tidy-data.html#broom"><i class="fa fa-check"></i><b>4.10</b> broom</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="tidy-data.html"><a href="tidy-data.html#nesting"><i class="fa fa-check"></i><b>4.10.1</b> Nesting</a></li>
<li class="chapter" data-level="4.10.2" data-path="tidy-data.html"><a href="tidy-data.html#mapping"><i class="fa fa-check"></i><b>4.10.2</b> Mapping</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="tidy-data.html"><a href="tidy-data.html#ggplot2"><i class="fa fa-check"></i><b>4.11</b> ggplot2</a>
<ul>
<li class="chapter" data-level="4.11.1" data-path="motivation.html"><a href="motivation.html#motivation"><i class="fa fa-check"></i><b>4.11.1</b> Motivation</a></li>
<li class="chapter" data-level="4.11.2" data-path="tidy-data.html"><a href="tidy-data.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>4.11.2</b> The grammar of graphics</a></li>
<li class="chapter" data-level="4.11.3" data-path="tidy-data.html"><a href="tidy-data.html#mapping-and-geom"><i class="fa fa-check"></i><b>4.11.3</b> mapping and geom</a></li>
<li class="chapter" data-level="4.11.4" data-path="tidy-data.html"><a href="tidy-data.html#basic-aes-x-y"><i class="fa fa-check"></i><b>4.11.4</b> basic aes (x , y)</a></li>
<li class="chapter" data-level="4.11.5" data-path="tidy-data.html"><a href="tidy-data.html#univariate-distribution"><i class="fa fa-check"></i><b>4.11.5</b> Univariate distribution</a></li>
<li class="chapter" data-level="4.11.6" data-path="tidy-data.html"><a href="tidy-data.html#advanced-aes-size-color"><i class="fa fa-check"></i><b>4.11.6</b> Advanced aes (size, color)</a></li>
<li class="chapter" data-level="4.11.7" data-path="tidy-data.html"><a href="tidy-data.html#co-ordinates-and-scales"><i class="fa fa-check"></i><b>4.11.7</b> Co-ordinates and scales</a></li>
<li class="chapter" data-level="4.11.8" data-path="tidy-data.html"><a href="tidy-data.html#labels-and-guides"><i class="fa fa-check"></i><b>4.11.8</b> Labels and guides</a></li>
<li class="chapter" data-level="4.11.9" data-path="tidy-data.html"><a href="tidy-data.html#ggsave"><i class="fa fa-check"></i><b>4.11.9</b> ggsave</a></li>
<li class="chapter" data-level="4.11.10" data-path="tidy-data.html"><a href="tidy-data.html#many-plots"><i class="fa fa-check"></i><b>4.11.10</b> Many plots</a></li>
<li class="chapter" data-level="4.11.11" data-path="tidy-data.html"><a href="tidy-data.html#transforming"><i class="fa fa-check"></i><b>4.11.11</b> Transforming</a></li>
<li class="chapter" data-level="4.11.12" data-path="tidy-data.html"><a href="tidy-data.html#ploting-models"><i class="fa fa-check"></i><b>4.11.12</b> Ploting models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="functional-programming.html"><a href="functional-programming.html"><i class="fa fa-check"></i><b>5</b> Automating repeated things</a>
<ul>
<li class="chapter" data-level="5.1" data-path="functional-programming.html"><a href="functional-programming.html#flow-control"><i class="fa fa-check"></i><b>5.1</b> Flow control</a></li>
<li class="chapter" data-level="5.2" data-path="functional-programming.html"><a href="functional-programming.html#functions"><i class="fa fa-check"></i><b>5.2</b> Functions</a></li>
<li class="chapter" data-level="5.3" data-path="functional-programming.html"><a href="functional-programming.html#for-loop"><i class="fa fa-check"></i><b>5.3</b> for loop</a></li>
<li class="chapter" data-level="5.4" data-path="functional-programming.html"><a href="functional-programming.html#apply-family"><i class="fa fa-check"></i><b>5.4</b> apply family</a></li>
<li class="chapter" data-level="5.5" data-path="functional-programming.html"><a href="functional-programming.html#purrr"><i class="fa fa-check"></i><b>5.5</b> purrr</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="functional-programming.html"><a href="functional-programming.html#why-map"><i class="fa fa-check"></i><b>5.5.1</b> Why map?</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="functional-programming.html"><a href="functional-programming.html#automote-2-or-2-tasks"><i class="fa fa-check"></i><b>5.6</b> Automote 2 or 2+ tasks</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="functional-programming.html"><a href="functional-programming.html#objectives-1"><i class="fa fa-check"></i><b>5.6.1</b> Objectives</a></li>
<li class="chapter" data-level="5.6.2" data-path="functional-programming.html"><a href="functional-programming.html#problem"><i class="fa fa-check"></i><b>5.6.2</b> Problem</a></li>
<li class="chapter" data-level="5.6.3" data-path="functional-programming.html"><a href="functional-programming.html#for-loop-1"><i class="fa fa-check"></i><b>5.6.3</b> For loop</a></li>
<li class="chapter" data-level="5.6.4" data-path="functional-programming.html"><a href="functional-programming.html#map2-pmap"><i class="fa fa-check"></i><b>5.6.4</b> map2 &amp; pmap</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="functional-programming.html"><a href="functional-programming.html#automate-plotting"><i class="fa fa-check"></i><b>5.7</b> Automate plotting</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="functional-programming.html"><a href="functional-programming.html#objective"><i class="fa fa-check"></i><b>5.7.1</b> Objective</a></li>
<li class="chapter" data-level="5.7.2" data-path="functional-programming.html"><a href="functional-programming.html#problem-1"><i class="fa fa-check"></i><b>5.7.2</b> Problem</a></li>
<li class="chapter" data-level="5.7.3" data-path="functional-programming.html"><a href="functional-programming.html#solution"><i class="fa fa-check"></i><b>5.7.3</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="functional-programming.html"><a href="functional-programming.html#automate-joining"><i class="fa fa-check"></i><b>5.8</b> Automate joining</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="functional-programming.html"><a href="functional-programming.html#objective-1"><i class="fa fa-check"></i><b>5.8.1</b> Objective</a></li>
<li class="chapter" data-level="5.8.2" data-path="functional-programming.html"><a href="functional-programming.html#problem-2"><i class="fa fa-check"></i><b>5.8.2</b> Problem</a></li>
<li class="chapter" data-level="5.8.3" data-path="functional-programming.html"><a href="functional-programming.html#copy-and-paste"><i class="fa fa-check"></i><b>5.8.3</b> Copy and paste</a></li>
<li class="chapter" data-level="5.8.4" data-path="functional-programming.html"><a href="functional-programming.html#reduce"><i class="fa fa-check"></i><b>5.8.4</b> reduce</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="functional-programming.html"><a href="functional-programming.html#make-automation-slower-or-faster"><i class="fa fa-check"></i><b>5.9</b> Make automation slower or faster</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="functional-programming.html"><a href="functional-programming.html#objectives-2"><i class="fa fa-check"></i><b>5.9.1</b> Objectives</a></li>
<li class="chapter" data-level="5.9.2" data-path="functional-programming.html"><a href="functional-programming.html#how-to-make-automation-slower"><i class="fa fa-check"></i><b>5.9.2</b> How to make automation slower</a></li>
<li class="chapter" data-level="5.9.3" data-path="functional-programming.html"><a href="functional-programming.html#for-loop-2"><i class="fa fa-check"></i><b>5.9.3</b> For loop</a></li>
<li class="chapter" data-level="5.9.4" data-path="functional-programming.html"><a href="functional-programming.html#map"><i class="fa fa-check"></i><b>5.9.4</b> Map</a></li>
<li class="chapter" data-level="5.9.5" data-path="functional-programming.html"><a href="functional-programming.html#how-to-make-automation-faster"><i class="fa fa-check"></i><b>5.9.5</b> How to make automation Faster</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="functional-programming.html"><a href="functional-programming.html#make-error-handling-easier"><i class="fa fa-check"></i><b>5.10</b> Make error handling easier</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="functional-programming.html"><a href="functional-programming.html#learning-objective"><i class="fa fa-check"></i><b>5.10.1</b> Learning objective</a></li>
<li class="chapter" data-level="5.10.2" data-path="functional-programming.html"><a href="functional-programming.html#solution-1"><i class="fa fa-check"></i><b>5.10.2</b> Solution</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="functional-programming.html"><a href="functional-programming.html#developing-your-own-data-tools"><i class="fa fa-check"></i><b>5.11</b> Developing your own data tools</a>
<ul>
<li class="chapter" data-level="5.11.1" data-path="functional-programming.html"><a href="functional-programming.html#why-developing-r-packages"><i class="fa fa-check"></i><b>5.11.1</b> Why developing R packages?</a></li>
<li class="chapter" data-level="5.11.2" data-path="functional-programming.html"><a href="functional-programming.html#workflow"><i class="fa fa-check"></i><b>5.11.2</b> Workflow</a></li>
<li class="chapter" data-level="5.11.3" data-path="functional-programming.html"><a href="functional-programming.html#developing-an-r-package"><i class="fa fa-check"></i><b>5.11.3</b> Developing an R package</a></li>
<li class="chapter" data-level="5.11.4" data-path="functional-programming.html"><a href="functional-programming.html#required-components"><i class="fa fa-check"></i><b>5.11.4</b> Required Components</a></li>
<li class="chapter" data-level="5.11.5" data-path="functional-programming.html"><a href="functional-programming.html#optional-components"><i class="fa fa-check"></i><b>5.11.5</b> Optional Components</a></li>
<li class="chapter" data-level="5.11.6" data-path="functional-programming.html"><a href="functional-programming.html#building-an-r-package"><i class="fa fa-check"></i><b>5.11.6</b> Building an R package</a></li>
<li class="chapter" data-level="5.11.7" data-path="functional-programming.html"><a href="functional-programming.html#distributing-an-r-package"><i class="fa fa-check"></i><b>5.11.7</b> Distributing an R package</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="semi-structured-data.html"><a href="semi-structured-data.html"><i class="fa fa-check"></i><b>6</b> Semi-structured data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="functional-programming.html"><a href="functional-programming.html#objectives"><i class="fa fa-check"></i><b>6.1</b> Objectives</a></li>
<li class="chapter" data-level="6.2" data-path="semi-structured-data.html"><a href="semi-structured-data.html#what-is-semi-structured-data"><i class="fa fa-check"></i><b>6.2</b> What is semi-structured data?</a></li>
<li class="chapter" data-level="6.3" data-path="functional-programming.html"><a href="functional-programming.html#workflow"><i class="fa fa-check"></i><b>6.3</b> Workflow</a></li>
<li class="chapter" data-level="6.4" data-path="semi-structured-data.html"><a href="semi-structured-data.html#htmlcss-web-scraping"><i class="fa fa-check"></i><b>6.4</b> HTML/CSS: web scraping</a></li>
<li class="chapter" data-level="6.5" data-path="semi-structured-data.html"><a href="semi-structured-data.html#xmljson-social-media-scraping"><i class="fa fa-check"></i><b>6.5</b> XML/JSON: social media scraping</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="semi-structured-data.html"><a href="semi-structured-data.html#api"><i class="fa fa-check"></i><b>6.5.1</b> API</a></li>
<li class="chapter" data-level="6.5.2" data-path="semi-structured-data.html"><a href="semi-structured-data.html#hydrating"><i class="fa fa-check"></i><b>6.5.2</b> Hydrating</a></li>
<li class="chapter" data-level="6.5.3" data-path="semi-structured-data.html"><a href="semi-structured-data.html#parsing-json"><i class="fa fa-check"></i><b>6.5.3</b> Parsing JSON</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="machine-learning.html"><a href="machine-learning.html"><i class="fa fa-check"></i><b>7</b> High-dimensional data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="machine-learning.html"><a href="machine-learning.html#overview"><i class="fa fa-check"></i><b>7.1</b> Overview</a></li>
<li class="chapter" data-level="7.2" data-path="machine-learning.html"><a href="machine-learning.html#dataset"><i class="fa fa-check"></i><b>7.2</b> Dataset</a></li>
<li class="chapter" data-level="7.3" data-path="functional-programming.html"><a href="functional-programming.html#workflow"><i class="fa fa-check"></i><b>7.3</b> Workflow</a></li>
<li class="chapter" data-level="7.4" data-path="machine-learning.html"><a href="machine-learning.html#tidymodels"><i class="fa fa-check"></i><b>7.4</b> tidymodels</a></li>
<li class="chapter" data-level="7.5" data-path="machine-learning.html"><a href="machine-learning.html#pre-processing"><i class="fa fa-check"></i><b>7.5</b> Pre-processing</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="machine-learning.html"><a href="machine-learning.html#regression-setup"><i class="fa fa-check"></i><b>7.5.1</b> Regression setup</a></li>
<li class="chapter" data-level="7.5.2" data-path="machine-learning.html"><a href="machine-learning.html#classification-setup"><i class="fa fa-check"></i><b>7.5.2</b> Classification setup</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="machine-learning.html"><a href="machine-learning.html#supervised-learning"><i class="fa fa-check"></i><b>7.6</b> Supervised learning</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="machine-learning.html"><a href="machine-learning.html#ols-and-lasso"><i class="fa fa-check"></i><b>7.6.1</b> OLS and Lasso</a></li>
<li class="chapter" data-level="7.6.2" data-path="machine-learning.html"><a href="machine-learning.html#decision-tree"><i class="fa fa-check"></i><b>7.6.2</b> Decision tree</a></li>
<li class="chapter" data-level="7.6.3" data-path="machine-learning.html"><a href="machine-learning.html#random-forest"><i class="fa fa-check"></i><b>7.6.3</b> Random forest</a></li>
<li class="chapter" data-level="7.6.4" data-path="machine-learning.html"><a href="machine-learning.html#xgboost"><i class="fa fa-check"></i><b>7.6.4</b> XGboost</a></li>
<li class="chapter" data-level="7.6.5" data-path="semi-structured-data.html"><a href="semi-structured-data.html#applications"><i class="fa fa-check"></i><b>7.6.5</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="machine-learning.html"><a href="machine-learning.html#unsupervised-learning"><i class="fa fa-check"></i><b>7.7</b> Unsupervised learning</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="machine-learning.html"><a href="machine-learning.html#dimension-reduction"><i class="fa fa-check"></i><b>7.7.1</b> Dimension reduction</a></li>
<li class="chapter" data-level="7.7.2" data-path="machine-learning.html"><a href="machine-learning.html#topic-modeling"><i class="fa fa-check"></i><b>7.7.2</b> Topic modeling</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="machine-learning.html"><a href="machine-learning.html#bias-and-fairness-in-machine-learning"><i class="fa fa-check"></i><b>7.8</b> Bias and fairness in machine learning</a></li>
<li class="chapter" data-level="7.9" data-path="machine-learning.html"><a href="machine-learning.html#resources"><i class="fa fa-check"></i><b>7.9</b> Resources</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="machine-learning.html"><a href="machine-learning.html#books"><i class="fa fa-check"></i><b>7.9.1</b> Books</a></li>
<li class="chapter" data-level="7.9.2" data-path="machine-learning.html"><a href="machine-learning.html#lecture-slides"><i class="fa fa-check"></i><b>7.9.2</b> Lecture slides</a></li>
<li class="chapter" data-level="7.9.3" data-path="machine-learning.html"><a href="machine-learning.html#blog-posts"><i class="fa fa-check"></i><b>7.9.3</b> Blog posts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="big-data.html"><a href="big-data.html"><i class="fa fa-check"></i><b>8</b> Big data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="motivation.html"><a href="motivation.html#motivation"><i class="fa fa-check"></i><b>8.1</b> Motivation</a></li>
<li class="chapter" data-level="8.2" data-path="big-data.html"><a href="big-data.html#what-is-sql"><i class="fa fa-check"></i><b>8.2</b> What is SQL?</a></li>
<li class="chapter" data-level="8.3" data-path="big-data.html"><a href="big-data.html#learning-objectives"><i class="fa fa-check"></i><b>8.3</b> Learning objectives</a></li>
<li class="chapter" data-level="8.4" data-path="big-data.html"><a href="big-data.html#quick-overview"><i class="fa fa-check"></i><b>8.4</b> Quick overview</a></li>
<li class="chapter" data-level="8.5" data-path="intro.html"><a href="intro.html#setup"><i class="fa fa-check"></i><b>8.5</b> Setup</a></li>
<li class="chapter" data-level="8.6" data-path="intro.html"><a href="intro.html#packages"><i class="fa fa-check"></i><b>8.6</b> Packages</a></li>
<li class="chapter" data-level="8.7" data-path="big-data.html"><a href="big-data.html#datasets"><i class="fa fa-check"></i><b>8.7</b> Datasets</a></li>
<li class="chapter" data-level="8.8" data-path="functional-programming.html"><a href="functional-programming.html#workflow"><i class="fa fa-check"></i><b>8.8</b> Workflow</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="big-data.html"><a href="big-data.html#create-a-database"><i class="fa fa-check"></i><b>8.8.1</b> Create a database</a></li>
<li class="chapter" data-level="8.8.2" data-path="big-data.html"><a href="big-data.html#copy-an-object-as-a-table-to-the-database-push"><i class="fa fa-check"></i><b>8.8.2</b> Copy an object as a table to the database (push)</a></li>
<li class="chapter" data-level="8.8.3" data-path="big-data.html"><a href="big-data.html#quick-demonstrations"><i class="fa fa-check"></i><b>8.8.3</b> Quick demonstrations:</a></li>
<li class="chapter" data-level="8.8.4" data-path="big-data.html"><a href="big-data.html#tidy-way-dplyr---sql"><i class="fa fa-check"></i><b>8.8.4</b> Tidy-way: dplyr -&gt; SQL</a></li>
<li class="chapter" data-level="8.8.5" data-path="big-data.html"><a href="big-data.html#collect-pull"><i class="fa fa-check"></i><b>8.8.5</b> Collect (pull)</a></li>
<li class="chapter" data-level="8.8.6" data-path="big-data.html"><a href="big-data.html#disconnect"><i class="fa fa-check"></i><b>8.8.6</b> Disconnect</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="intro.html"><a href="intro.html#references"><i class="fa fa-check"></i><b>8.9</b> References</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/jaeyk/PS239T/" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Computational Thinking for Social Scientists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="big_data" class="section level1" number="8">
<h1><span class="header-section-number">Chapter 8</span> Big data</h1>
<div id="motivation" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Motivation</h2>
<ul>
<li>Big data problem: data is too big to fit into memory (=local environment).</li>
<li>R reads data into random-access memory (RAM) at once and this object lives in memory entirely. So, object &gt; memory will crash R.</li>
<li>So, the key to deal with big data in R is reducing the size of data you want to bring into it.</li>
</ul>
<p><strong>Techniques to deal with big data</strong></p>
<ul>
<li>Medium sized file (1-2 GB)
<ul>
<li>Try to reduce the size of the file using slicing and dicing</li>
<li>Tools:
<ul>
<li>R:<code>data.table::fread(file path, select = c("column 1", "column 2"))</code>. This command imports data faster than <code>read.csv()</code> does.</li>
<li>Command line: <a href="https://csvkit.readthedocs.io/en/latest/"><code>csvkit</code></a> - a suite of command-line tools to and working with CSV</li>
</ul></li>
</ul></li>
<li>Large file (&gt; 2-10 GB)
<ul>
<li>Put the data into a database and <strong>ACCESS</strong> it</li>
<li>Explore the data and pull the objects of interest</li>
<li>Types of databases
<ul>
<li>Relational database = a collection of tables (fixed columns and rows): SQL is a staple tool to define and <strong>query</strong> (focus of the workshop today) this type of database</li>
<li>Non-relational database = a collection of documents (MongoDB), key-values (Redis and DyanoDB), wide-column stores (Cassandra and HBase), or graph (Neo4j and JanusGraph). This type of database does not preclude SQL. Note that NoSQL stands for <a href="https://www.mongodb.com/nosql-explained">“not only SQL.”</a></li>
</ul></li>
</ul></li>
</ul>
<p><strong>Relational database</strong></p>
<div class="figure">
<img src="https://sp.mysqltutorial.org/wp-content/uploads/2009/12/MySQL-Sample-Database-Schema.png" alt="" />
<p class="caption">Relational Database. Source: MySQL Tutorial</p>
</div>
</div>
<div id="what-is-sql" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> What is SQL?</h2>
<ul>
<li><p>Structured Query Language. Called SEQUEL and developed by IBM Corporation in the 1970s.</p></li>
<li><p>Remains the standard language for a relational database management system.</p></li>
<li><p>It’s a DECLARATIVE language (<a href="https://www.sqlite.org/queryplanner.html">what to do &gt; how to do</a>)</p>
<ul>
<li>Database management systems figures optimal way to execute query (query optimization)</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb1096"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1096-1"><a href="big-data.html#cb1096-1"></a><span class="kw">SELECT</span> <span class="kw">COLUMN</span> <span class="kw">FROM</span> <span class="kw">TABLE</span> </span></code></pre></div>
</div>
<div id="learning-objectives" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Learning objectives</h2>
<ul>
<li><p>Embracing a new mindset: shifting from ownership (opening CSVs in your laptop) to access (accessing data stored in a database)</p></li>
<li><p>Learning how to use R and SQL to access and query a database</p></li>
</ul>
</div>
<div id="quick-overview" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> Quick overview</h2>
<ul>
<li>SQL and R</li>
</ul>
<table>
<colgroup>
<col width="14%" />
<col width="85%" />
</colgroup>
<thead>
<tr class="header">
<th>SQL</th>
<th>R</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SELECT</td>
<td>select() for columns, mutate() for expressions, summarise() for aggregates</td>
</tr>
<tr class="even">
<td>FROM</td>
<td>which data frame</td>
</tr>
<tr class="odd">
<td>WHERE</td>
<td>filter()</td>
</tr>
<tr class="even">
<td>GROUP BY</td>
<td>group_by()</td>
</tr>
<tr class="odd">
<td>HAVING</td>
<td>filter() <strong>after group_by()</strong></td>
</tr>
<tr class="even">
<td>ORDER BY</td>
<td>arrange()</td>
</tr>
<tr class="odd">
<td>LIMIT</td>
<td>head()</td>
</tr>
</tbody>
</table>
<p><strong>Challenge 1</strong>
1. Can you tell me the difference in the order in which the following <code>R</code> and <code>SQL</code> code were written to wrangle data? For instance, in R, what command comes first? In contrast, in SQL, what command comes first?</p>
<ul>
<li>R example</li>
</ul>
<div class="sourceCode" id="cb1097"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1097-1"><a href="big-data.html#cb1097-1"></a></span>
<span id="cb1097-2"><a href="big-data.html#cb1097-2"></a>data <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Data </span></span>
<span id="cb1097-3"><a href="big-data.html#cb1097-3"></a><span class="st">  </span><span class="kw">select</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Column</span></span>
<span id="cb1097-4"><a href="big-data.html#cb1097-4"></a><span class="st">  </span><span class="kw">filter</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Row </span></span>
<span id="cb1097-5"><a href="big-data.html#cb1097-5"></a><span class="st">  </span><span class="kw">group_by</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Group by </span></span>
<span id="cb1097-6"><a href="big-data.html#cb1097-6"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Aggregation</span></span>
<span id="cb1097-7"><a href="big-data.html#cb1097-7"></a><span class="st">  </span><span class="kw">filter</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Row </span></span>
<span id="cb1097-8"><a href="big-data.html#cb1097-8"></a><span class="st">  </span><span class="kw">order_by</span>() <span class="co"># Arrange </span></span></code></pre></div>
<ul>
<li>SQL example</li>
</ul>
<div class="sourceCode" id="cb1098"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1098-1"><a href="big-data.html#cb1098-1"></a></span>
<span id="cb1098-2"><a href="big-data.html#cb1098-2"></a><span class="kw">SELECT</span> <span class="kw">column</span>, aggregation (<span class="fu">count</span>())` # <span class="kw">Column</span></span>
<span id="cb1098-3"><a href="big-data.html#cb1098-3"></a></span>
<span id="cb1098-4"><a href="big-data.html#cb1098-4"></a><span class="kw">FROM</span> <span class="kw">data</span> # <span class="kw">Data</span> </span>
<span id="cb1098-5"><a href="big-data.html#cb1098-5"></a></span>
<span id="cb1098-6"><a href="big-data.html#cb1098-6"></a><span class="kw">WHERE</span> condition # <span class="kw">Row</span> </span>
<span id="cb1098-7"><a href="big-data.html#cb1098-7"></a></span>
<span id="cb1098-8"><a href="big-data.html#cb1098-8"></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="kw">column</span> # <span class="kw">Group</span> <span class="kw">by</span></span>
<span id="cb1098-9"><a href="big-data.html#cb1098-9"></a></span>
<span id="cb1098-10"><a href="big-data.html#cb1098-10"></a><span class="kw">HAVING</span> condition # <span class="kw">Row</span>  </span>
<span id="cb1098-11"><a href="big-data.html#cb1098-11"></a></span>
<span id="cb1098-12"><a href="big-data.html#cb1098-12"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="kw">column</span> # Arrange </span></code></pre></div>
<div class="figure">
<img src="https://wizardzines.com/zines/sql/samples/from.png" alt="" />
<p class="caption">SQL Zine by by <a href="https://jvns.ca/">Julia Evans</a></p>
</div>
</div>
<div id="setup" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Setup</h2>
<p>Let’s get to work.</p>
</div>
<div id="packages" class="section level2" number="8.6">
<h2><span class="header-section-number">8.6</span> Packages</h2>
<ul>
<li><code>pacman::p_load()</code> reduces steps for installing and loading several packages simultaneously.</li>
</ul>
<div class="sourceCode" id="cb1099"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1099-1"><a href="big-data.html#cb1099-1"></a><span class="co"># pacman </span></span>
<span id="cb1099-2"><a href="big-data.html#cb1099-2"></a><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(<span class="st">&quot;pacman&quot;</span>)) <span class="kw">install.packages</span>(<span class="st">&quot;pacman&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: pacman</code></pre>
<div class="sourceCode" id="cb1101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1101-1"><a href="big-data.html#cb1101-1"></a><span class="co"># The rest of pkgs </span></span>
<span id="cb1101-2"><a href="big-data.html#cb1101-2"></a>pacman<span class="op">::</span><span class="kw">p_load</span>(</span>
<span id="cb1101-3"><a href="big-data.html#cb1101-3"></a> </span>
<span id="cb1101-4"><a href="big-data.html#cb1101-4"></a> tidyverse, <span class="co"># tidyverse packages </span></span>
<span id="cb1101-5"><a href="big-data.html#cb1101-5"></a> </span>
<span id="cb1101-6"><a href="big-data.html#cb1101-6"></a> DBI, <span class="co"># using SQL queries</span></span>
<span id="cb1101-7"><a href="big-data.html#cb1101-7"></a> </span>
<span id="cb1101-8"><a href="big-data.html#cb1101-8"></a> RSQLite, <span class="co"># SQLite</span></span>
<span id="cb1101-9"><a href="big-data.html#cb1101-9"></a> </span>
<span id="cb1101-10"><a href="big-data.html#cb1101-10"></a> dbplyr, <span class="co"># use database with dplyr </span></span>
<span id="cb1101-11"><a href="big-data.html#cb1101-11"></a> </span>
<span id="cb1101-12"><a href="big-data.html#cb1101-12"></a> glue, <span class="co"># glue to automate workflow </span></span>
<span id="cb1101-13"><a href="big-data.html#cb1101-13"></a> </span>
<span id="cb1101-14"><a href="big-data.html#cb1101-14"></a> nycflights13 <span class="co"># toy data </span></span>
<span id="cb1101-15"><a href="big-data.html#cb1101-15"></a>)</span></code></pre></div>
</div>
<div id="datasets" class="section level2" number="8.7">
<h2><span class="header-section-number">8.7</span> Datasets</h2>
<ul>
<li><a href="https://www.transtats.bts.gov/DL_SelectFields.asp?Table_ID=236">The flight on-time performance data</a> from the Bureau of Transpiration Statistics of the U.S. government. The data goes back to 1987 and its size is more than 20 gigabytes. For practice, we only use a small subset of the original data (flight data departing NYC in 2013) provided by RStudio.</li>
</ul>
<div class="figure">
<img src="https://d33wubrfki0l68.cloudfront.net/245292d1ea724f6c3fd8a92063dcd7bfb9758d02/5751b/diagrams/relational-nycflights.png" alt="" />
<p class="caption">From RStudio.</p>
</div>
</div>
<div id="workflow" class="section level2" number="8.8">
<h2><span class="header-section-number">8.8</span> Workflow</h2>
<ol style="list-style-type: decimal">
<li>Create/connect to a database</li>
</ol>
<ul>
<li><p>Note that server also can be your laptop (called <a href="https://en.wikipedia.org/wiki/Localhost#:~:text=In%20computer%20networking%2C%20localhost%20is,via%20the%20loopback%20network%20interface.">localhost</a>).</p></li>
<li><p>Short answer: To do so, you need interfaces between R and a database. We use <a href="https://github.com/r-dbi/RSQLite"><code>RSQLite</code></a> in this tutorial because it’s easy to set up.</p></li>
<li><p>Long answer: The <code>DBI</code> package in R provides a client-side interface that allows <code>dplyr</code> to work with databases. DBI is automatically installed when you installed <code>dbplyr</code>. However, you need to install a specific backend engine (a tool for communication between R and a database management system) for the database (e.g., <code>RMariaDB</code>, <code>RPostgres</code>, <code>RSQLite</code>). In this workshop, we use SQLite because it is the easiest to get started with. Personally, I love PostgreSQL because it’s an open-source and also powerful to do <a href="https://www.postgresql.org/docs/current/functions.html">many amazing things</a> (e.g., text mining, geospatial analysis).</p></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Copy a table to the database</li>
</ol>
<ul>
<li><p>Option 1: You can create a table and insert rows manually.</p></li>
<li><p>Table</p>
<ul>
<li>Collection of rows</li>
<li>Collection of columns (fields or attributes)</li>
<li>Each col has a type:
<ul>
<li>String: <code>VARCHAR(20)</code></li>
<li>Integer: <code>INTEGER</code></li>
<li>Floating-point: <code>FLOAT</code>, <code>DOUBLE</code></li>
<li>Date/time: <code>DATE</code>, <code>TIME</code>, <code>DATETIME</code></li>
</ul></li>
<li><strong>Schema</strong>: the structure of the database
<ul>
<li>The table name</li>
<li>The names and types of its columns</li>
<li>Various optional additional information (e.g., constraints)</li>
</ul></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb1102"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1102-1"><a href="big-data.html#cb1102-1"></a></span>
<span id="cb1102-2"><a href="big-data.html#cb1102-2"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> students (</span>
<span id="cb1102-3"><a href="big-data.html#cb1102-3"></a>    <span class="kw">id</span> <span class="dt">INT</span> AUTO_INCREMENT,</span>
<span id="cb1102-4"><a href="big-data.html#cb1102-4"></a>    name <span class="dt">VARCHAR</span>(<span class="dv">30</span>),</span>
<span id="cb1102-5"><a href="big-data.html#cb1102-5"></a>    birth <span class="dt">DATE</span>,</span>
<span id="cb1102-6"><a href="big-data.html#cb1102-6"></a>    gpa <span class="dt">FLOAT</span>,</span>
<span id="cb1102-7"><a href="big-data.html#cb1102-7"></a>    grad <span class="dt">INT</span>,</span>
<span id="cb1102-8"><a href="big-data.html#cb1102-8"></a>    <span class="kw">PRIMARY</span> <span class="kw">KEY</span>(<span class="kw">id</span>));</span>
<span id="cb1102-9"><a href="big-data.html#cb1102-9"></a>    </span>
<span id="cb1102-10"><a href="big-data.html#cb1102-10"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> students(name, birth, gpa, grad)</span>
<span id="cb1102-11"><a href="big-data.html#cb1102-11"></a>      <span class="kw">VALUES</span> (<span class="st">&#39;Adam&#39;</span>, <span class="st">&#39;2000-08-04&#39;</span>, <span class="fl">4.0</span>, <span class="dv">2020</span>);</span></code></pre></div>
<ul>
<li>Option 2: Copy a file (object) to a table in a database using <code>copy_to</code>). We take this option as it’s fast and we would like to focus on querying in this workshop.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Query the table</li>
</ol>
<ul>
<li>Main focus</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li><p>Pull the results of interests (<strong>data</strong>) using <code>collect()</code></p></li>
<li><p>Disconnect the database</p></li>
</ol>
<div id="create-a-database" class="section level3" number="8.8.1">
<h3><span class="header-section-number">8.8.1</span> Create a database</h3>
<div class="sourceCode" id="cb1103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1103-1"><a href="big-data.html#cb1103-1"></a><span class="co"># Define a backend engine </span></span>
<span id="cb1103-2"><a href="big-data.html#cb1103-2"></a></span>
<span id="cb1103-3"><a href="big-data.html#cb1103-3"></a>drv &lt;-<span class="st"> </span>RSQLite<span class="op">::</span><span class="kw">SQLite</span>()</span>
<span id="cb1103-4"><a href="big-data.html#cb1103-4"></a></span>
<span id="cb1103-5"><a href="big-data.html#cb1103-5"></a><span class="co"># Create an empty in-memory database </span></span>
<span id="cb1103-6"><a href="big-data.html#cb1103-6"></a>con &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbConnect</span>(drv, </span>
<span id="cb1103-7"><a href="big-data.html#cb1103-7"></a>                      <span class="dt">dbname =</span> <span class="st">&quot;:memory:&quot;</span>)</span>
<span id="cb1103-8"><a href="big-data.html#cb1103-8"></a></span>
<span id="cb1103-9"><a href="big-data.html#cb1103-9"></a><span class="co"># Connect to an existing database </span></span>
<span id="cb1103-10"><a href="big-data.html#cb1103-10"></a><span class="co">#con &lt;- DBI::dbConnect(RMariaDB::MariaDB(), </span></span>
<span id="cb1103-11"><a href="big-data.html#cb1103-11"></a> <span class="co"># host = &quot;database.rstudio.com&quot;,</span></span>
<span id="cb1103-12"><a href="big-data.html#cb1103-12"></a> <span class="co"># user = &quot;hadley&quot;,</span></span>
<span id="cb1103-13"><a href="big-data.html#cb1103-13"></a> <span class="co"># password = rstudioapi::askForPassword(&quot;Database password&quot;)</span></span>
<span id="cb1103-14"><a href="big-data.html#cb1103-14"></a><span class="co">#)</span></span>
<span id="cb1103-15"><a href="big-data.html#cb1103-15"></a></span>
<span id="cb1103-16"><a href="big-data.html#cb1103-16"></a><span class="kw">dbListTables</span>(con)</span></code></pre></div>
<pre><code>## character(0)</code></pre>
<ul>
<li>Note that con is empty at this stage.</li>
</ul>
</div>
<div id="copy-an-object-as-a-table-to-the-database-push" class="section level3" number="8.8.2">
<h3><span class="header-section-number">8.8.2</span> Copy an object as a table to the database (push)</h3>
<div class="sourceCode" id="cb1105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1105-1"><a href="big-data.html#cb1105-1"></a><span class="co"># Copy objects to the data </span></span>
<span id="cb1105-2"><a href="big-data.html#cb1105-2"></a><span class="kw">copy_to</span>(<span class="dt">dest =</span> con, </span>
<span id="cb1105-3"><a href="big-data.html#cb1105-3"></a>        <span class="dt">df =</span> flights)</span>
<span id="cb1105-4"><a href="big-data.html#cb1105-4"></a></span>
<span id="cb1105-5"><a href="big-data.html#cb1105-5"></a><span class="kw">copy_to</span>(<span class="dt">dest =</span> con, </span>
<span id="cb1105-6"><a href="big-data.html#cb1105-6"></a>        <span class="dt">df =</span> airports)</span>
<span id="cb1105-7"><a href="big-data.html#cb1105-7"></a></span>
<span id="cb1105-8"><a href="big-data.html#cb1105-8"></a><span class="kw">copy_to</span>(<span class="dt">dest =</span> con,</span>
<span id="cb1105-9"><a href="big-data.html#cb1105-9"></a>        <span class="dt">df =</span> planes)</span>
<span id="cb1105-10"><a href="big-data.html#cb1105-10"></a></span>
<span id="cb1105-11"><a href="big-data.html#cb1105-11"></a><span class="kw">copy_to</span>(<span class="dt">dest =</span> con, </span>
<span id="cb1105-12"><a href="big-data.html#cb1105-12"></a>        <span class="dt">df =</span> weather)</span>
<span id="cb1105-13"><a href="big-data.html#cb1105-13"></a></span>
<span id="cb1105-14"><a href="big-data.html#cb1105-14"></a><span class="co"># If you want you can also decide what columns you want to copy:</span></span>
<span id="cb1105-15"><a href="big-data.html#cb1105-15"></a></span>
<span id="cb1105-16"><a href="big-data.html#cb1105-16"></a><span class="co"># copy_to(dest = con, </span></span>
<span id="cb1105-17"><a href="big-data.html#cb1105-17"></a><span class="co">#          df = flights, </span></span>
<span id="cb1105-18"><a href="big-data.html#cb1105-18"></a><span class="co">#          name = &quot;flights&quot;,</span></span>
<span id="cb1105-19"><a href="big-data.html#cb1105-19"></a><span class="co">#          indexes = list(c(&quot;year&quot;, &quot;tailnum&quot;, &quot;dest&quot;)))</span></span></code></pre></div>
<div class="sourceCode" id="cb1106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1106-1"><a href="big-data.html#cb1106-1"></a><span class="co"># Show two tables in the database </span></span>
<span id="cb1106-2"><a href="big-data.html#cb1106-2"></a></span>
<span id="cb1106-3"><a href="big-data.html#cb1106-3"></a><span class="kw">dbListTables</span>(con)</span></code></pre></div>
<pre><code>## [1] &quot;airports&quot;     &quot;flights&quot;      &quot;planes&quot;       &quot;sqlite_stat1&quot; &quot;sqlite_stat4&quot;
## [6] &quot;weather&quot;</code></pre>
<div class="sourceCode" id="cb1108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1108-1"><a href="big-data.html#cb1108-1"></a><span class="co"># Show the columns/attributes/fields of a table </span></span>
<span id="cb1108-2"><a href="big-data.html#cb1108-2"></a></span>
<span id="cb1108-3"><a href="big-data.html#cb1108-3"></a><span class="kw">dbListFields</span>(con, <span class="st">&quot;flights&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;year&quot;           &quot;month&quot;          &quot;day&quot;            &quot;dep_time&quot;      
##  [5] &quot;sched_dep_time&quot; &quot;dep_delay&quot;      &quot;arr_time&quot;       &quot;sched_arr_time&quot;
##  [9] &quot;arr_delay&quot;      &quot;carrier&quot;        &quot;flight&quot;         &quot;tailnum&quot;       
## [13] &quot;origin&quot;         &quot;dest&quot;           &quot;air_time&quot;       &quot;distance&quot;      
## [17] &quot;hour&quot;           &quot;minute&quot;         &quot;time_hour&quot;</code></pre>
<div class="sourceCode" id="cb1110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1110-1"><a href="big-data.html#cb1110-1"></a><span class="kw">dbListFields</span>(con, <span class="st">&quot;weather&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;origin&quot;     &quot;year&quot;       &quot;month&quot;      &quot;day&quot;        &quot;hour&quot;      
##  [6] &quot;temp&quot;       &quot;dewp&quot;       &quot;humid&quot;      &quot;wind_dir&quot;   &quot;wind_speed&quot;
## [11] &quot;wind_gust&quot;  &quot;precip&quot;     &quot;pressure&quot;   &quot;visib&quot;      &quot;time_hour&quot;</code></pre>
</div>
<div id="quick-demonstrations" class="section level3" number="8.8.3">
<h3><span class="header-section-number">8.8.3</span> Quick demonstrations:</h3>
<ul>
<li><p>SELECT desired columns</p></li>
<li><p>FROM tables</p></li>
<li><p>Select all columns (*) from <code>flights</code> table and show the <code>first ten rows</code></p></li>
<li><p>Note that you can combine SQL and R commands thanks to <code>dbplyr</code>.</p></li>
<li><p>Option 1</p></li>
</ul>
<div class="sourceCode" id="cb1112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1112-1"><a href="big-data.html#cb1112-1"></a>DBI<span class="op">::</span><span class="kw">dbGetQuery</span>(con, <span class="st">&quot;SELECT * FROM flights;&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1112-2"><a href="big-data.html#cb1112-2"></a><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>) </span></code></pre></div>
<pre><code>##    year month day dep_time sched_dep_time dep_delay arr_time sched_arr_time
## 1  2013     1   1      517            515         2      830            819
## 2  2013     1   1      533            529         4      850            830
## 3  2013     1   1      542            540         2      923            850
## 4  2013     1   1      544            545        -1     1004           1022
## 5  2013     1   1      554            600        -6      812            837
## 6  2013     1   1      554            558        -4      740            728
## 7  2013     1   1      555            600        -5      913            854
## 8  2013     1   1      557            600        -3      709            723
## 9  2013     1   1      557            600        -3      838            846
## 10 2013     1   1      558            600        -2      753            745
##    arr_delay carrier flight tailnum origin dest air_time distance hour minute
## 1         11      UA   1545  N14228    EWR  IAH      227     1400    5     15
## 2         20      UA   1714  N24211    LGA  IAH      227     1416    5     29
## 3         33      AA   1141  N619AA    JFK  MIA      160     1089    5     40
## 4        -18      B6    725  N804JB    JFK  BQN      183     1576    5     45
## 5        -25      DL    461  N668DN    LGA  ATL      116      762    6      0
## 6         12      UA   1696  N39463    EWR  ORD      150      719    5     58
## 7         19      B6    507  N516JB    EWR  FLL      158     1065    6      0
## 8        -14      EV   5708  N829AS    LGA  IAD       53      229    6      0
## 9         -8      B6     79  N593JB    JFK  MCO      140      944    6      0
## 10         8      AA    301  N3ALAA    LGA  ORD      138      733    6      0
##     time_hour
## 1  1357034400
## 2  1357034400
## 3  1357034400
## 4  1357034400
## 5  1357038000
## 6  1357034400
## 7  1357038000
## 8  1357038000
## 9  1357038000
## 10 1357038000</code></pre>
<ul>
<li><p>Option 2 (works faster)</p></li>
<li><p>Option 3 (automating workflow)</p>
<ul>
<li>When local variables are updated, the SQL query is also automatically updated.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb1114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1114-1"><a href="big-data.html#cb1114-1"></a><span class="co"># Local variables </span></span>
<span id="cb1114-2"><a href="big-data.html#cb1114-2"></a>tbl &lt;-<span class="st"> &quot;flights&quot;</span></span>
<span id="cb1114-3"><a href="big-data.html#cb1114-3"></a>var &lt;-<span class="st"> &quot;dep_delay&quot;</span></span>
<span id="cb1114-4"><a href="big-data.html#cb1114-4"></a>num &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb1114-5"><a href="big-data.html#cb1114-5"></a></span>
<span id="cb1114-6"><a href="big-data.html#cb1114-6"></a><span class="co"># Glue SQL query string </span></span>
<span id="cb1114-7"><a href="big-data.html#cb1114-7"></a><span class="co"># Note that to indicate a numeric value, you don&#39;t need ``</span></span>
<span id="cb1114-8"><a href="big-data.html#cb1114-8"></a></span>
<span id="cb1114-9"><a href="big-data.html#cb1114-9"></a>sql_query &lt;-<span class="st"> </span><span class="kw">glue_sql</span>(<span class="st">&quot;</span></span>
<span id="cb1114-10"><a href="big-data.html#cb1114-10"></a><span class="st">  SELECT {`var`}</span></span>
<span id="cb1114-11"><a href="big-data.html#cb1114-11"></a><span class="st">  FROM {`tbl`}</span></span>
<span id="cb1114-12"><a href="big-data.html#cb1114-12"></a><span class="st">  LIMIT {num} </span></span>
<span id="cb1114-13"><a href="big-data.html#cb1114-13"></a><span class="st">  &quot;</span>, <span class="dt">.con =</span> con)</span>
<span id="cb1114-14"><a href="big-data.html#cb1114-14"></a></span>
<span id="cb1114-15"><a href="big-data.html#cb1114-15"></a><span class="co"># Run the query </span></span>
<span id="cb1114-16"><a href="big-data.html#cb1114-16"></a><span class="kw">dbGetQuery</span>(con, sql_query)</span></code></pre></div>
<pre><code>##   dep_delay
## 1         2
## 2         4
## 3         2
## 4        -1
## 5        -6</code></pre>
<p><strong>Challenge 2</strong>
Can you rewrite the above code using <code>LIMIT</code> instead of <code>head(10)</code></p>
<ul>
<li><p>You may notice that using only SQL code makes querying faster.</p></li>
<li><p>Select dep_delay and arr_delay from flights table, show the first ten rows, then turn the result into a tibble.</p></li>
</ul>
<p><strong>Challenge 3</strong>
Could you remind me how to see the list of attributes of a table? Let’s say you want to see the attributes of <code>flights</code> table.</p>
<ul>
<li>Collect the selected columns and filtered rows</li>
</ul>
<div class="sourceCode" id="cb1116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1116-1"><a href="big-data.html#cb1116-1"></a>df &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con, <span class="st">&quot;SELECT dep_delay, arr_delay FROM flights;&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb1116-2"><a href="big-data.html#cb1116-2"></a><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb1116-3"><a href="big-data.html#cb1116-3"></a><span class="st">  </span><span class="kw">collect</span>()</span></code></pre></div>
<ul>
<li><p>Counting rows</p>
<ul>
<li>Count all (*)</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb1117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1117-1"><a href="big-data.html#cb1117-1"></a><span class="kw">dbGetQuery</span>(con, </span>
<span id="cb1117-2"><a href="big-data.html#cb1117-2"></a>          <span class="st">&quot;SELECT COUNT(*) </span></span>
<span id="cb1117-3"><a href="big-data.html#cb1117-3"></a><span class="st">           FROM flights;&quot;</span>) </span></code></pre></div>
<pre><code>##   COUNT(*)
## 1   336776</code></pre>
<div class="sourceCode" id="cb1119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1119-1"><a href="big-data.html#cb1119-1"></a><span class="kw">dbGetQuery</span>(con, </span>
<span id="cb1119-2"><a href="big-data.html#cb1119-2"></a>           <span class="st">&quot;SELECT COUNT(dep_delay)</span></span>
<span id="cb1119-3"><a href="big-data.html#cb1119-3"></a><span class="st">           FROM flights;&quot;</span>)</span></code></pre></div>
<pre><code>##   COUNT(dep_delay)
## 1           328521</code></pre>
<ul>
<li>Count distinct values</li>
</ul>
<div class="sourceCode" id="cb1121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1121-1"><a href="big-data.html#cb1121-1"></a><span class="kw">dbGetQuery</span>(con, </span>
<span id="cb1121-2"><a href="big-data.html#cb1121-2"></a>           <span class="st">&quot;SELECT COUNT(DISTINCT dep_delay)</span></span>
<span id="cb1121-3"><a href="big-data.html#cb1121-3"></a><span class="st">           FROM flights;&quot;</span>)</span></code></pre></div>
<pre><code>##   COUNT(DISTINCT dep_delay)
## 1                       527</code></pre>
</div>
<div id="tidy-way-dplyr---sql" class="section level3" number="8.8.4">
<h3><span class="header-section-number">8.8.4</span> Tidy-way: dplyr -&gt; SQL</h3>
<p>Thanks to the <code>dbplyr</code> package you can use the <code>dplyr</code> syntax to query SQL.</p>
<ul>
<li>Note that pipe (%) works.</li>
</ul>
<div class="sourceCode" id="cb1123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1123-1"><a href="big-data.html#cb1123-1"></a><span class="co"># tbl select tables</span></span>
<span id="cb1123-2"><a href="big-data.html#cb1123-2"></a>flights &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tbl</span>(<span class="st">&quot;flights&quot;</span>)</span>
<span id="cb1123-3"><a href="big-data.html#cb1123-3"></a>airports &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tbl</span>(<span class="st">&quot;airports&quot;</span>)</span>
<span id="cb1123-4"><a href="big-data.html#cb1123-4"></a>planes &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tbl</span>(<span class="st">&quot;planes&quot;</span>)</span>
<span id="cb1123-5"><a href="big-data.html#cb1123-5"></a>weather &lt;-<span class="st"> </span>con <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tbl</span>(<span class="st">&quot;weather&quot;</span>)</span></code></pre></div>
<ul>
<li><code>select</code> = <code>SELECT</code></li>
</ul>
<div class="sourceCode" id="cb1124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1124-1"><a href="big-data.html#cb1124-1"></a>flights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1124-2"><a href="big-data.html#cb1124-2"></a><span class="st">  </span><span class="kw">select</span>(<span class="kw">contains</span>(<span class="st">&quot;delay&quot;</span>))</span></code></pre></div>
<pre><code>## # Source:   lazy query [?? x 2]
## # Database: sqlite 3.33.0 [:memory:]
##    dep_delay arr_delay
##        &lt;dbl&gt;     &lt;dbl&gt;
##  1         2        11
##  2         4        20
##  3         2        33
##  4        -1       -18
##  5        -6       -25
##  6        -4        12
##  7        -5        19
##  8        -3       -14
##  9        -3        -8
## 10        -2         8
## # … with more rows</code></pre>
<p><strong>Challenge 4</strong>
Your turn: write the same code in SQL</p>
<ul>
<li><code>mutate</code> = <code>SELECT</code> <code>AS</code></li>
</ul>
<div class="sourceCode" id="cb1126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1126-1"><a href="big-data.html#cb1126-1"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb1126-2"><a href="big-data.html#cb1126-2"></a><span class="st">  </span><span class="kw">select</span>(distance, air_time) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb1126-3"><a href="big-data.html#cb1126-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">speed =</span> distance <span class="op">/</span><span class="st"> </span>(air_time <span class="op">/</span><span class="st"> </span><span class="dv">60</span>)) </span></code></pre></div>
<pre><code>## # Source:   lazy query [?? x 3]
## # Database: sqlite 3.33.0 [:memory:]
##    distance air_time speed
##       &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1     1400      227  370.
##  2     1416      227  374.
##  3     1089      160  408.
##  4     1576      183  517.
##  5      762      116  394.
##  6      719      150  288.
##  7     1065      158  404.
##  8      229       53  259.
##  9      944      140  405.
## 10      733      138  319.
## # … with more rows</code></pre>
<p><strong>Challenge 5</strong>
Your turn: write the same code in SQL (hint: <code>mutate(new_var = var 1 * var2</code> = <code>SELECT var1 * var2 AS near_var</code>)</p>
<ul>
<li><code>filter</code> = <code>WHERE</code></li>
</ul>
<div class="sourceCode" id="cb1128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1128-1"><a href="big-data.html#cb1128-1"></a>flights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1128-2"><a href="big-data.html#cb1128-2"></a><span class="st">  </span><span class="kw">filter</span>(month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # Source:   lazy query [?? x 19]
## # Database: sqlite 3.33.0 [:memory:]
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # … with more rows, and 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dbl&gt;</code></pre>
<p><strong>Challenge 6</strong>
Your turn: write the same code in SQL (hint: <code>filter(condition1, condition2)</code> = <code>WHERE condition1 and condition2</code>)</p>
<ul>
<li><p>Note that R and SQL operators are not exactly alike. R uses <code>!=</code> for <code>Not equal to</code>. SQL uses <code>&lt;&gt;</code> or <code>!=</code>. Furthermore, there are some cautions about using <code>NULL</code> (NA; unknown or missing): it should be <code>IS NULL</code> or <code>IS NOT NULL</code> not <code>=NULL</code> or <code>!=NULL</code>.</p></li>
<li><p><code>arrange</code> = <code>ORDER BY</code></p></li>
</ul>
<div class="sourceCode" id="cb1130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1130-1"><a href="big-data.html#cb1130-1"></a>flights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1130-2"><a href="big-data.html#cb1130-2"></a><span class="st">  </span><span class="kw">arrange</span>(carrier, <span class="kw">desc</span>(arr_delay)) <span class="op">%&gt;%</span></span>
<span id="cb1130-3"><a href="big-data.html#cb1130-3"></a><span class="st">  </span><span class="kw">show_query</span>()</span></code></pre></div>
<pre><code>## &lt;SQL&gt;
## SELECT *
## FROM `flights`
## ORDER BY `carrier`, `arr_delay` DESC</code></pre>
<p><strong>Challenge 7</strong>
Your turn: write the same code in SQL (hint: <code>arrange(var1, desc(var2)) = ORDER BY var1, var2 DESC</code>)</p>
<ul>
<li><code>summarise</code> = <code>SELECT</code> <code>AS</code> and <code>group by</code> = <code>GROUP BY</code></li>
</ul>
<div class="sourceCode" id="cb1132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1132-1"><a href="big-data.html#cb1132-1"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb1132-2"><a href="big-data.html#cb1132-2"></a><span class="st">  </span><span class="kw">group_by</span>(month, day) <span class="op">%&gt;%</span></span>
<span id="cb1132-3"><a href="big-data.html#cb1132-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay)) </span></code></pre></div>
<pre><code>## Warning: Missing values are always removed in SQL.
## Use `mean(x, na.rm = TRUE)` to silence this warning
## This warning is displayed only once per session.</code></pre>
<pre><code>## # Source:   lazy query [?? x 3]
## # Database: sqlite 3.33.0 [:memory:]
## # Groups:   month
##    month   day delay
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1     1     1 11.5 
##  2     1     2 13.9 
##  3     1     3 11.0 
##  4     1     4  8.95
##  5     1     5  5.73
##  6     1     6  7.15
##  7     1     7  5.42
##  8     1     8  2.55
##  9     1     9  2.28
## 10     1    10  2.84
## # … with more rows</code></pre>
<p><strong>Challenge 8</strong>
Your turn: write the same code in SQL (hint: in SQL the order should be <code>SELECT group_var1, group_var2, AVG(old_var) AS new_var</code> -&gt; <code>FROM</code> -&gt; <code>GROUP BY</code>)</p>
<ul>
<li>If you feel too much challenged, here’s a help.</li>
</ul>
<div class="sourceCode" id="cb1135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1135-1"><a href="big-data.html#cb1135-1"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb1135-2"><a href="big-data.html#cb1135-2"></a><span class="st">  </span><span class="kw">group_by</span>(month, day) <span class="op">%&gt;%</span></span>
<span id="cb1135-3"><a href="big-data.html#cb1135-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay)) <span class="op">%&gt;%</span></span>
<span id="cb1135-4"><a href="big-data.html#cb1135-4"></a><span class="st">  </span><span class="kw">show_query</span>() <span class="co"># Show the SQL equivalent!</span></span></code></pre></div>
<pre><code>## &lt;SQL&gt;
## SELECT `month`, `day`, AVG(`dep_delay`) AS `delay`
## FROM `flights`
## GROUP BY `month`, `day`</code></pre>
<ul>
<li><p>Joins</p></li>
<li><p>Using joins is simpler in R than it is in SQL.</p></li>
<li><p>However, more flexible joins exist in SQL and they are not available in R.</p>
<ul>
<li>Joins involving 3+ tables are not supported.</li>
<li>Some advanced joins available in SQL are not supported.</li>
<li>For more information, check out <a href="https://github.com/ianmcook/tidyquery/issues"><code>tidyquery</code></a> to see the latest developments.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb1137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1137-1"><a href="big-data.html#cb1137-1"></a>flights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1137-2"><a href="big-data.html#cb1137-2"></a><span class="st">  </span><span class="kw">left_join</span>(weather, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb1137-3"><a href="big-data.html#cb1137-3"></a><span class="st">  </span><span class="kw">show_query</span>()</span></code></pre></div>
<pre><code>## &lt;SQL&gt;
## SELECT `LHS`.`year` AS `year`, `LHS`.`month` AS `month`, `LHS`.`day` AS `day.x`, `LHS`.`dep_time` AS `dep_time`, `LHS`.`sched_dep_time` AS `sched_dep_time`, `LHS`.`dep_delay` AS `dep_delay`, `LHS`.`arr_time` AS `arr_time`, `LHS`.`sched_arr_time` AS `sched_arr_time`, `LHS`.`arr_delay` AS `arr_delay`, `LHS`.`carrier` AS `carrier`, `LHS`.`flight` AS `flight`, `LHS`.`tailnum` AS `tailnum`, `LHS`.`origin` AS `origin.x`, `LHS`.`dest` AS `dest`, `LHS`.`air_time` AS `air_time`, `LHS`.`distance` AS `distance`, `LHS`.`hour` AS `hour.x`, `LHS`.`minute` AS `minute`, `LHS`.`time_hour` AS `time_hour.x`, `RHS`.`origin` AS `origin.y`, `RHS`.`day` AS `day.y`, `RHS`.`hour` AS `hour.y`, `RHS`.`temp` AS `temp`, `RHS`.`dewp` AS `dewp`, `RHS`.`humid` AS `humid`, `RHS`.`wind_dir` AS `wind_dir`, `RHS`.`wind_speed` AS `wind_speed`, `RHS`.`wind_gust` AS `wind_gust`, `RHS`.`precip` AS `precip`, `RHS`.`pressure` AS `pressure`, `RHS`.`visib` AS `visib`, `RHS`.`time_hour` AS `time_hour.y`
## FROM `flights` AS `LHS`
## LEFT JOIN `weather` AS `RHS`
## ON (`LHS`.`year` = `RHS`.`year` AND `LHS`.`month` = `RHS`.`month`)</code></pre>
</div>
<div id="collect-pull" class="section level3" number="8.8.5">
<h3><span class="header-section-number">8.8.5</span> Collect (pull)</h3>
<ul>
<li><p><code>collect()</code> is used to pull the data. Depending on the data size, it may take a long time to run.</p></li>
<li><p>The following code won’t work.</p></li>
</ul>
<blockquote>
<p>Error in UseMethod(“collect”) : no applicable method for ‘collect’ applied to an object of class “c(‘LayerInstance’, ‘Layer’, ‘ggproto’, ‘gg’)”</p>
</blockquote>
<div class="sourceCode" id="cb1139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1139-1"><a href="big-data.html#cb1139-1"></a>origin_flights_plot &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></span>
<span id="cb1139-2"><a href="big-data.html#cb1139-2"></a><span class="st">  </span><span class="kw">group_by</span>(origin) <span class="op">%&gt;%</span></span>
<span id="cb1139-3"><a href="big-data.html#cb1139-3"></a><span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span></span>
<span id="cb1139-4"><a href="big-data.html#cb1139-4"></a><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb1139-5"><a href="big-data.html#cb1139-5"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x =</span> origin, <span class="dt">y =</span> n)) <span class="op">%&gt;%</span></span>
<span id="cb1139-6"><a href="big-data.html#cb1139-6"></a><span class="st">  </span><span class="kw">collect</span>()</span></code></pre></div>
<ul>
<li>This works.</li>
</ul>
<div class="sourceCode" id="cb1140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1140-1"><a href="big-data.html#cb1140-1"></a>df &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></span>
<span id="cb1140-2"><a href="big-data.html#cb1140-2"></a><span class="st">  </span><span class="kw">group_by</span>(origin) <span class="op">%&gt;%</span></span>
<span id="cb1140-3"><a href="big-data.html#cb1140-3"></a><span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span></span>
<span id="cb1140-4"><a href="big-data.html#cb1140-4"></a><span class="st">  </span><span class="kw">collect</span>()</span>
<span id="cb1140-5"><a href="big-data.html#cb1140-5"></a></span>
<span id="cb1140-6"><a href="big-data.html#cb1140-6"></a>origin_flights_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df) <span class="op">+</span></span>
<span id="cb1140-7"><a href="big-data.html#cb1140-7"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">x =</span> origin, <span class="dt">y =</span> n))</span>
<span id="cb1140-8"><a href="big-data.html#cb1140-8"></a></span>
<span id="cb1140-9"><a href="big-data.html#cb1140-9"></a>origin_flights_plot</span></code></pre></div>
<p><img src="06_big_data_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
<div id="disconnect" class="section level3" number="8.8.6">
<h3><span class="header-section-number">8.8.6</span> Disconnect</h3>
<div class="sourceCode" id="cb1141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1141-1"><a href="big-data.html#cb1141-1"></a>DBI<span class="op">::</span><span class="kw">dbDisconnect</span>(con)</span></code></pre></div>
</div>
</div>
<div id="references" class="section level2" number="8.9">
<h2><span class="header-section-number">8.9</span> References</h2>
<ul>
<li><a href="https://github.com/csv2db/csv2db">csv2db</a> - for loading large CSV files in to a database</li>
<li>R Studio, <a href="https://db.rstudio.com/">Database using R</a></li>
<li>Ian Cook, <a href="https://github.com/ianmcook/rstudioconf2020/blob/master/bridging_the_gap_between_sql_and_r.pdf">“Bridging the Gap between SQL and R”</a> rstudio::conf 2020 slides
<ul>
<li><a href="https://www.youtube.com/watch?v=JwP5KdWSgqE&amp;ab_channel=RStudio">Video recording</a></li>
</ul></li>
<li>Data Carpentry contributors, <a href="https://datacarpentry.org/R-ecology-lesson/05-r-and-databases.html">SQL database and R</a>, Data Carpentry, September 10, 2019.</li>
<li><a href="https://cran.r-project.org/web/packages/dbplyr/vignettes/dbplyr.html">Introduction to dbplyr</a></li>
<li>Josh Erickson, <a href="http://dept.stat.lsa.umich.edu/~jerrick/courses/stat701/notes/sql.html">SQL in R</a>, STAT 701, University of Michigan</li>
<li><a href="https://wizardzines.com/zines/sql/">SQL zine</a> by Julia Evans</li>
<li><a href="http://harelba.github.io/q/">q</a> - a command line tool that allows direct execution of SQL-like queries on CSVs/TSVs (and any other tabular text files)</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="machine-learning.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
